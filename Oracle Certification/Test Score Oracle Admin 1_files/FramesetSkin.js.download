var itdTickTimeType=0;var itdTickTimeTypeSet=false;var itdUA=window.navigator.userAgent.toLowerCase();var isAccurateTime=(typeof(window.performance)!="undefined"&&typeof(performance.now||performance.webkitNow||performance.msNow||performance.oNow||performance.mozNow)!="undefined");var timeCheckAccuracy=(itdUA.indexOf("safari")>=0&&itdUA.indexOf("chrome")==-1&&itdUA.indexOf("securebrowser")==-1&&itdUA.indexOf("itsmobile")==-1)?10000:1000;var itdCurrentLocation="(FramesetSkin - Loading)";var itdItemLoadedStatus="Item Loading ";var itdIsOpera=!!window.opera||navigator.userAgent.indexOf(' OPR/')>=0;var itdIsFirefox=typeof InstallTrigger!=='undefined';var itdIsChrome=!!window.chrome&&!itdIsOpera;var itdIsMacSB=false;try{itdIsMacSB=external.IsSecureBrowser}catch(e){itdIsMacSB=false}if(itdIsMacSB===undefined)itdIsMacSB=false;itdIsMacSB=itdIsMacSB&&navigator.userAgent.indexOf('MacOSXSB')>=0;var itdIsSafari=itdIsMacSB||(Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor')>0)||(!itdIsChrome&&!itdIsOpera&&typeof window.webkitAudioContext!=="undefined");if(!window.console){window.console={log:function(){}}}var itdNow=(function(){var a=window.performance||{};a.now=(function(){return a.now||a.webkitNow||a.msNow||a.oNow||a.mozNow||function(){return new Date().getTime()}})();return Math.floor(a.now())});function ITDGetTickTime(){if(!itdTickTimeTypeSet){var a=-1;try{a=external.GetTickCount()}catch(e){a=-1}if(a>=0)itdTickTimeType=1;itdTickTimeTypeSet=true}switch(itdTickTimeType){case 1:isAccurateTime=true;return external.GetTickCount();default:return itdNow()}}var isSkinFrameset=true;var errorShutDown=false;var inFatalSystemError=false;var awaitingTimeoutAction=false;var awaitingTimeoutTimeSpent=0;var isNavigating=true;var itdLoadComplete=false;var tickIsAlive=false;var checkLiveTickCount=0;var audioType=0;var audioRecording=false;var audioRecorded=false;var ttsPlaying=false;var sentSolDisplayed=false;var lastNavCMD="LOAD";var vChangeTestOptions=false;var itemStartTime=0;var totalStartTime=0;var navStartTime=ITDGetTickTime();var loadingCheckTime=navStartTime;var loadStartTime=navStartTime;var loadEndTime=navStartTime;var xmlHttpRequestWaitBegin=navStartTime;var onLoadCalled=false;var isStarting=true;var lastNavValue=0;var lastTickValue=0;var timeSpentBeforePause=0;var timerMode=0;var nav02Counter=0;var addTickErrorAction=false;var startTickError=0;var tickError="";var unhandledTimeOut=true;var timeoutCalled=false;var vMediaTotalTime;var vNextFunc;var objCurrentMediaPlayer;var objCurrentMediaProgressBar;var vPlayAudioOn=false;var vMediaOffSet=0;var pageInit=false;var blnWorkShopPreview=false;var blnBlockEscape=true;var vScoreDialogWindow;var vPopupWidth=0.6;var vPopupRemainder=1-vPopupWidth;var vTestKeys=new Array();var vItemKeys=null;var vTotalTestKeys=0;var vTotalItemKeys=0;var vThisBrowser=-1;var vThisOperatingSystem=-1;var vStartTest=false;var vIsDragging=false;var vCurrentKeyboardLayoutIndex=0;var vITDLog='';var vITDLogCount=0;var vITDLogWindow;var vITDMediaErrorAttempts=0;var vITDAllowLogging=false;var vLastActivity=ITDGetTickTime();var vSettingInsertSentence=false;var vReviewGroupItems=new Array();var itdIsFixedSupported=null;var vLastLocation="";var vLastItemList="";var currentItemStartTime=0;var currentItemStartTimeIndex=0;var currentItemTimeSpentBeforePause=0;var navigateTDCalledFromCallback=false;var testTimer=0;var mediaTimer=0;var audioTimer=0;var navigateTDCallbackTimeout=null;var onLoadTimeout=null;var setIdCursorOnTimeout=null;var restoreSinglePassageTimeout=null;var restoreMultiplePassageTimeout=null;var setAnswerResponseTimeout=null;var setPassageLinkTimeout=null;var selectMarkerTimeout=null;var toggleTargetSentenceGroupTimeout=null;var loadInsertedSentenceTimeout=null;var togglePassageSelectSolutionTimeout=null;var toggleSentenceSolutionTimeout=null;var ITDSetAnsweredStatusTimeout=null;var ITDIllegalKeyShutdownTimeout=null;var scoreDialogTimeout=null;function ITDIsFixedSupported(){if(itdIsFixedSupported==null){var a=elementFrame();var b=a.document;var c=b.body;itdIsFixedSupported=false;if(b.createElement&&c&&c.appendChild&&c.removeChild){var d=b.createElement('div');if(d.getBoundingClientRect){d.innerHTML='x';d.style.cssText='position:fixed;top:100px;';c.appendChild(d);var e=c.style.height,originalScrollTop=c.scrollTop;c.style.height='3000px';c.scrollTop=500;var f=d.getBoundingClientRect().top;c.style.height=e;var g=(f===100);c.removeChild(d);c.scrollTop=originalScrollTop;itdIsFixedSupported=g}}}return itdIsFixedSupported}function ITDAddLog(a){if(!vITDAllowLogging)return;if(vITDLogCount>=500){vITDLog='';vITDLogCount=0}vITDLog+=(new Date().toString())+': '+a+'<br>';vITDLogCount++}function ITDShowLog(){if(!vITDAllowLogging)return;var a='<'+'body oncontextmenu="return false">'+vITDLog+'<'+'/body><'+'/html>';var b='<'+'html><'+'head><'+'title>ITD Log<'+'/title><'+'/head>';if(!vITDLogWindow||vITDLogWindow.closed){vITDLogWindow=window.open('','itdlog','width=560,height=460,status=no,toolbar=no,menubar=no,location=no,resizable=yes,scrollbars=yes');vITDLogWindow.document.write(b+a);vITDLogWindow.document.close()}else{vITDLogWindow.document.write(b+a);vITDLogWindow.document.close();vITDLogWindow.focus()}}function ITDSetUtcOffset(){var a=elementFrame();if(a!=null){a.document.forms[0].UTCO.value=(new Date()).getTimezoneOffset()}}function ITDSaveComment(a){if(itdLoadComplete&&!isNavigating&&a&&a.length>0){var b=new Array();var c=elementFrame();var d="";var e="";if(c&&typeof c.getCurrentItemName=='function'){d=c.getCurrentItemName();e=c.getCurrentPublishingKey();if(d&&d.length>0){b[0]=CreatePostFormElement('ItemName',d);b[1]=CreatePostFormElement('Comment',a);b[2]=CreatePostFormElement('PublishingKey',e);PostITSXmlHttpRequest("itdcomment.aspx?cmd=save&data="+vQueryStringData,b)}}}}function ITDAddEventSimple(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else if(a.attachEvent)a.attachEvent('on'+b,c)}function ITDRemoveEventSimple(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,false);else if(a.detachEvent)a.detachEvent('on'+b,c)}function ITDStopEvent(e,w){w=(w)?w:window;e=(e)?e:((w.event)?w.event:null);if(e.stopPropagation){e.stopPropagation();e.preventDefault()}else{e.cancelBubble=true;e.returnValue=false}return false}function ITDSetWindowZoomFactor(a,b){var c;if(itd!=a&&typeof(a.itdPageIsFrameset)=="undefined"&&typeof(a.document)!="undefined"&&typeof(a.document.body)!="undefined"){if(typeof(a.document.body.style.zoom)!="undefined"&&a.document.body.getAttribute("NoZoom")!="1"&&(a.document.body.style.zoom==""||a.document.body.getAttribute("Zoomable")=="1")){a.document.body.style.zoom=b;a.document.body.setAttribute("Zoomable","1")}}for(c=0;c<a.frames.length;c++){ITDSetWindowZoomFactor(a.frames[c],b)}}function zoomTest(a){if(itdLoadComplete&&!isNavigating){try{var b=elementFrame().document;var c=b.getElementById("ZoomFactor");var d=parseFloat(a);if(!isNaN(d)){if(c==null){var f=b.forms[0];c=b.createElement("input");c.id="ZoomFactor";c.name="ZoomFactor";c.type="hidden";f.appendChild(c)}c.value=a;ITDSetWindowZoomFactor(itd,d)}}catch(e){}}}function ITDResetLastActivity(){vLastActivity=ITDGetTickTime();vITDMediaErrorAttempts=0}var fatalErrorCode="";var fatalErrorLine="";var fatalErrorUrl="";var fatalErrorMsg="";var fatalMsg="";var fatalAdditionalMsg="";var fatalShowConfirm=false;function fatalExitExam(){forceCloseBrowser(true)}function fatalError(a){if(inFatalSystemError||errorShutDown||(typeof(isItemPreviewMode)!='undefined'&&isItemPreviewMode))return;errorShutDown=true;if(itd.location.href.toLowerCase().indexOf("itslocal")>=0){if(arguments.length>=2)fatalErrorCode=arguments[1];else fatalErrorCode="";fatalErrorLine="";fatalErrorMsg=a;ITDAlert(a,fatalLocal)}else ITDAlert(a,fatalExitExam);window.clearInterval(testTimer);return}function fatalLocal(){var a="code: \""+fatalErrorCode+"\"";var b=null;var c=false;var d=false;try{if(typeof elementFrame=="function"){b=elementFrame();if(typeof b.vItemIds!="undefined"){var f=b.vItemIds.join();if(f.substr(0,1)=",")f=f.substr(1);a+=", items: \""+f+"\"";c=true}if(typeof b.vCurrentLocation!="undefined"){a+=", location: \""+b.vCurrentLocation+"\"";d=true}}}catch(e){}try{if(!c&&vLastItemList.length>0)a+=", items*: \""+vLastItemList+"\"";if(!d&&vLastLocation.length>0)a+=", location* :\""+vLastLocation+"\""}catch(e){}if(fatalErrorLine.length>0||fatalErrorUrl.length>0||fatalErrorMsg.length>0)a+=', line: "'+decodeURIComponent(fatalErrorLine)+'", url: "'+decodeURIComponent(fatalErrorUrl)+'", msg: "'+decodeURIComponent(fatalErrorMsg)+'"';try{external.HandleError(a)}catch(e){}}function fatalAttemptRestart(){var a='';var b=null;var c=false;var d=false;if(arguments.length>=1&&arguments[0])a="&esaw=0";try{if(typeof elementFrame=="function"){b=elementFrame();if(typeof b.vItemIds!="undefined"){var f=b.vItemIds.join();if(f.substr(0,1)=",")f=f.substr(1);a+="&eitm="+encodeURIComponent(f);c=true}if(typeof b.vCurrentLocation!="undefined"){a+="&eloc="+encodeURIComponent(b.vCurrentLocation);d=true}}}catch(e){}try{if(!c&&vLastItemList.length>0)a+="&eitm="+encodeURIComponent(vLastItemList+"*");if(!d&&vLastLocation.length>0)a+="&eloc="+encodeURIComponent(vLastLocation+"*")}catch(e){}if(fatalErrorLine.length>0||fatalErrorUrl.length>0||fatalErrorMsg.length>0)a+='&eln='+fatalErrorLine+'&eurl='+fatalErrorUrl+'&emsg='+fatalErrorMsg;if(itd.location.protocol.substr(0,3)!='itd'){var g=new Array();var h=Math.floor(Math.random()*10000);g[0]=CreatePostFormElement("PingValue",h.toString(10));if(vXmlHttp==null)vXmlHttp=GetITSXmlHttpObject(ITSXmlHttpCallbackMethod);var i=PostXmlHttpRequest(vXmlHttp,"itd.aspx?CMD=PING",g,false);if(parseInt(i,10)==h){if(itd.location.href.toLowerCase().indexOf("itdlocalstart")==-1)itd.location.href="ITDStart.aspx?SE="+fatalErrorCode+a;else itd.location.href="ITDLocalStart.aspx?SE="+fatalErrorCode+a;return}}else{itd.location.replace(itd.location.protocol+"//localhost/itdstart.aspx?SE="+fatalErrorCode+"&data="+vQueryStringData+a);return}fatalAdditionalMsg=itd.CEAttempt.replace("%datetime%",(new Date().toTimeString()));fatalSystemErrorProcessing()}function fatalConfirm(a){if(a==1){if(arguments.length>=2)fatalAttemptRestart(arguments[1]);else fatalAttemptRestart()}else fatalExitExam()}function fatalSystemErrorProcessing(){var a=(typeof(vCustomOptions)!='undefined'&&(vCustomOptions&1)==1);var b=readCookie("ITSTBSD");var c='';var d=false;var e=false;if(itd.location.protocol.substr(0,3)=='itd')d=true;if(itd.location.href.toLowerCase().indexOf("itslocal")>=0){message=itd.CEClose;if(fatalMsg.length>=0)message+=fatalMsg;ITDAlert(message,fatalLocal)}else if(d||(b!=null&&b.length!=0)){if(fatalAdditionalMsg.length!=0||(vStartError&&(ITDGetTickTime()-loadStartTime)<60000)){if(!a){message=itd.CERestartCancel;fatalShowConfirm=true}else{message=itd.CERestartCancel;fatalShowConfirm=false}}else{e=true;message=""}if(fatalMsg.length>0)message+=fatalMsg;message+=fatalAdditionalMsg;if(e){fatalConfirm(1,true)}else if(fatalShowConfirm){ITDConfirm(message,fatalConfirm)}else{ITDAlert(message,fatalAttemptRestart)}}else{message=itd.CEClose;if(fatalMsg.length>=0)message+=fatalMsg;if(a)ITDAlert(message,fatalExitExam);else ITDAlert(message,fatalAttemptRestart)}window.clearInterval(testTimer)}function removeErrorAttributes(a){var b=a.indexOf("?");var c=a.substr(0,b+1);var d=a.substr(b+1).split("&");var e="";var i=0;for(i=0;i<d.length;i++){if(d[i].indexOf("eln")==-1&&d[i].indexOf("eurl")==-1&&d[i].indexOf("emsg")==-1){c+=e+d[i];e="&"}}}function fatalSystemError(a){if(inFatalSystemError||errorShutDown||(typeof(isItemPreviewMode)!='undefined'&&isItemPreviewMode))return;inFatalSystemError=true;fatalAdditionalMsg="";fatalErrorCode=a;fatalShowConfirm=false;if(arguments.length>=2)fatalMsg=arguments[1];else fatalMsg="";if(arguments.length>=5){fatalErrorLine=encodeURIComponent(arguments[4]);fatalErrorUrl=encodeURIComponent(removeErrorAttributes(arguments[3]));fatalErrorMsg=encodeURIComponent(itdItemLoadedStatus+itdCurrentLocation+" "+arguments[2])}else{fatalErrorLine="";fatalErrorUrl="";fatalErrorMsg=encodeURIComponent(itdItemLoadedStatus+itdCurrentLocation)}fatalSystemErrorProcessing()}function untrappedSystemError(a,b,l){fatalSystemError('5001','',a,b,l);return true}window.onerror=untrappedSystemError;function checkTickTime(){if(!awaitingTimeoutAction){var a=ITDGetTickTime();var b=0;if(!itd.itdLoadComplete||itd.isNavigating)return;if(lastTickValue>0&&itemStartTime>0){b=a-lastTickValue;if(!isAccurateTime&&(b>=timeCheckAccuracy||b<0)){var c=itemStartTime+b-400;if(c<a)itemStartTime=c;else fatalSystemError('2002');var d=currentItemStartTime+b-400;if(d<a)currentItemStartTime=d;var e=vLastActivity+b-400;if(e<a)vLastActivity=e}}}lastTickValue=a}function checkNavTime(){var a=ITDGetTickTime();var b=0;if(!itd.itdLoadComplete||itd.isNavigating)return;if(lastNavValue>0&&navStartTime>0){b=a-lastNavValue;if(!isAccurateTime&&(b>=timeCheckAccuracy||b<0)){var c=navStartTime+b-400;if(c<a)navStartTime=c}}lastNavValue=a}function timeSpent(){checkTickTime();if(awaitingTimeoutAction)return awaitingTimeoutTimeSpent;var a=elementFrame();var b=0;var c=ITDGetTickTime();if(itemStartTime>0)b=(c-itemStartTime)+timeSpentBeforePause;else b=timeSpentBeforePause;if(b<0){try{var d=itd.TIMEError;d=d.replace("%start%",itemStartTime.toString());d=d.replace("%end%",c.toString());d=d.replace("%duration%",b.toString());d=d.replace("%pause%",timeSpentBeforePause.toString());d=d.replace("%mode%",timerMode.toString());d=d.replace("%max%",a.vMaxTimeAllowed.toString());d=d.replace("%alive%",tickIsAlive.toString());fatalSystemError('2001',d)}catch(ex){fatalSystemError('2003')}}if(a.vTimingEnabled&&a.vMaxTimeAllowed>0&&b>a.vMaxTimeAllowed){b=a.vMaxTimeAllowed}return b}function currentItemTimeSpent(){checkTickTime();if(awaitingTimeoutAction)return awaitingTimeoutTimeSpent;var a=elementFrame();var b=0;var c=ITDGetTickTime();if(currentItemStartTime>0)b=(c-currentItemStartTime)+currentItemTimeSpentBeforePause;else b=currentItemTimeSpentBeforePause;if(b<0){try{var d=itd.TIMEError;d=d.replace("%start%",currentItemStartTime.toString());d=d.replace("%end%",c.toString());d=d.replace("%duration%",b.toString());d=d.replace("%pause%",currentItemTimeSpentBeforePause.toString());d=d.replace("%mode%",timerMode.toString());d=d.replace("%max%",a.vMaxTimeAllowed.toString());d=d.replace("%alive%",tickIsAlive.toString());fatalSystemError('2001',d)}catch(ex){fatalSystemError('2003')}}if(a.vTimingEnabled&&a.vMaxTimeAllowed>0&&b>a.vMaxTimeAllowed){b=a.vMaxTimeAllowed}return b}function AreExamineesIncomplete(a){var b=new Array();if(vXmlHttp==null)vXmlHttp=GetITSXmlHttpObject(ITSXmlHttpCallbackMethod);var c=PostXmlHttpRequest(vXmlHttp,"itd.aspx?CMD=CHECKCOMPLETE&checkcomplete="+encodeURIComponent(a)+"&data="+vQueryStringData,b,false);if(parseInt(c,10)==1){return true}return false}function totalTimeSpent(){return ITDGetTickTime()-totalStartTime}function ITDResetLoadingCheckTime(){loadingCheckTime=ITDGetTickTime()}function ITDSetPageComplete(){try{var a=elementFrame().document.forms[0];if(isComplete())a.PC.value="1";else a.PC.value="0"}catch(ex){return false}return true}function updateTiming(){try{var a=elementFrame().document.forms[0];a.TimeSpentOnObject.value=timeSpent();if(typeof a.TotalTimeSpentOnObject!="undefined")a.TotalTimeSpentOnObject.value=totalTimeSpent()}catch(ex){return false}return true}function updateCurrentItemTiming(a){try{var b=elementFrame().document.forms[0];if(b.CountTimeSpent!=null){if(currentItemStartTimeIndex>0){var c=currentItemTimeSpent();var d=parseInt(b["TimeSpent"+currentItemStartTimeIndex.toString()].value);var e=parseInt(b["Visits"+currentItemStartTimeIndex.toString()].value);b["TimeSpent"+currentItemStartTimeIndex.toString()].value=(d+c).toString();b["Visits"+currentItemStartTimeIndex.toString()].value=(e+1).toString();currentItemStartTime=ITDGetTickTime()}currentItemStartTimeIndex=a}}catch(ex){return false}return true}function resetTiming(){itemStartTime=0;lastTickValue=0;currentItemStartTime=0;timeSpentBeforePause=0;currentItemTimeSpentBeforePause=0}function startTiming(){if(arguments.length==0||arguments[0]){resetTiming()}if(itemStartTime==0){itemStartTime=ITDGetTickTime();currentItemStartTime=itemStartTime;lastTickValue=itemStartTime}timerMode=1}function stopTiming(){if(arguments.length==0||arguments[0]){timerMode=3;timeSpentBeforePause=timeSpent();currentItemTimeSpentBeforePause=currentItemTimeSpent()}lastTickValue=0;itemStartTime=0;currentItemStartTime=0}function isElementFrameContentLoaded(){if(typeof(isItemPreviewMode)!='undefined'&&isItemPreviewMode)return true;if(typeof itd.frames["ElementDisplayFrame"]!="undefined"&&(typeof itd.frames["ElementDisplayFrame"].itdPageIsFrameset=="undefined"||(itd.frames["ElementDisplayFrame"].itdPageIsFrameset&&itd.frames["ElementDisplayFrame"].frames.length>0)))return true;return false}function focusElementFrame(){var a=elementFrame();if(typeof(a)!="undefined"){try{a.focus()}catch(e){}}}function onLoad(){var a;itdCurrentLocation="(onLoad Started)";if(onLoadTimeout!=null){window.clearTimeout(onLoadTimeout);onLoadTimeout=null}if(pageInit&&itd.controlpanelloaded&&itd.infopanelloaded&&isElementFrameContentLoaded()&&((tickIsAlive&&checkLiveTickCount>0)||checkLiveTickCount>5)){ITDResetLastActivity();isStarting=false;unhandledTimeOut=true;awaitingTimeoutAction=false;timeoutCalled=false;audioRecording=false;audioRecorded=false;if(!tickIsAlive){window.clearInterval(testTimer);testTimer=window.setInterval(function(){tick()},400)}var b=elementFrame();var c=null;if(typeof b.document.forms[0]!="undefined")c=b.document.forms[0];itdCurrentLocation="(onLoad SetForm)";if(c){if(typeof c.NavigationTime!="undefined")c.NavigationTime.value=(ITDGetTickTime()-navStartTime);if(typeof c.NavigationCMD!="undefined")c.NavigationCMD.value=lastNavCMD;if(typeof c.TimeToPageStart!="undefined"&&(loadStartTime>navStartTime))c.TimeToPageStart.value=(loadStartTime-navStartTime);if(typeof c.TimeToPageEnd!="undefined"&&(loadEndTime>navStartTime))c.TimeToPageEnd.value=(loadEndTime-navStartTime)}itdCurrentLocation="(onLoad InitRGI)";if(typeof b.ITDElementInitReviewGroupItems=='function')b.ITDElementInitReviewGroupItems();totalStartTime=ITDGetTickTime();itdCurrentLocation="(onLoad resetTiming)";if(!b.vManualTimer)startTiming(true);else if(timerMode==0){timerMode=4;resetTiming()}itdCurrentLocation="(onLoad setCursors)";if(typeof(setCursors)=="function")setCursors("default");itdCurrentLocation="(onLoad hideNavGraphic)";if(typeof(hideNavGraphic)=="function")hideNavGraphic();itdCurrentLocation="(onLoad updatePanels)";if(typeof(updatePanels)=="function")updatePanels();itd.isNavigating=false;itdCurrentLocation="(onLoad enableButtons)";if(!b.vManualButtons&&typeof(enableButtons)=="function")enableButtons();itdCurrentLocation="(onLoad ITDSetUtcOffset)";ITDSetUtcOffset();itd.itdLoadComplete=true;itdCurrentLocation="(onLoad PLNavigationComplete)";if(typeof(PLNavigationComplete)=="function")PLNavigationComplete();if(b.vContinuousPlay){a=(b.vUIType.toLowerCase()=="review")?"review-all":"next";$(document).ready(function(e){setTimeout(function(){navigateTD(a)},1)})}else if(typeof(itdProctorNavigationCommand)!="undefined"&&itdProctorNavigationCommand!=null){itdCurrentLocation="(onLoad PLNavigateTD)";PLNavigateTD()}else{itdCurrentLocation="(onLoad PLNavigateTD)";if(typeof(isItemPreviewMode)=='undefined'||!isItemPreviewMode)focusElementFrame()}vLastItemList=b.vItemIds.join();if(vLastItemList.substr(0,1)==",")vLastItemList=vLastItemList.substr(1);vLastLocation=b.vCurrentLocation;itdCurrentLocation="(onLoad Ended)"}else{if(checkLiveTickCount==0)tickIsAlive=false;checkLiveTickCount+=1;itdCurrentLocation="(onLoad SetTimeoutEnded)";onLoadTimeout=window.setTimeout(function(){onLoad()},100)}}function swapLanguage(a){navigateTD("SWAPLANGUAGE","language="+a)}function swapContentLanguage(a){navigateTD("SWAPCONTENTLANGUAGE","language="+a)}function changeTestOptions(a){vChangeTestOptions=true;navigateTD("TESTOPTIONS","options="+a.toString())}function navigateTD(a){itdCurrentLocation="(navigateTD Starting)";var b=a.toLowerCase();var c=arguments;ITDResetLastActivity();if(navigateTDCalledFromCallback||(!itd.isNavigating&&itd.itdLoadComplete&&itd.controlpanelloaded&&itd.infopanelloaded)){itdCurrentLocation="(navigateTD elementFrame)";var d=elementFrame();if(navigateTDCallbackTimeout!=null){window.clearTimeout(navigateTDCallbackTimeout);navigateTDCallbackTimeout=null}if(!navigateTDCalledFromCallback){itd.itdLoadComplete=false;itd.isNavigating=true;var f=timerMode;navStartTime=ITDGetTickTime();loadingCheckTime=navStartTime;onLoadCalled=false;timerMode=0;if(b=='timeout')timeoutCalled=true;if(unhandledTimeOut&&b!='timeout'&&d.vTimingEnabled&&getTimeRemaining(d.vMaxTimeAllowed,timeSpent())<=0){timerMode=f;itd.itdLoadComplete=true;itd.isNavigating=false;performTimeout();if(timeoutCalled)return}if(b=='next'&&typeof(d.vIsAnswerLock)!="undefined"&&d.vIsAnswerLock&&d.moveToNextAnswerLockItem()){timerMode=f;itd.isNavigating=false;itd.itdLoadComplete=true;focusElementFrame();return}itdCurrentLocation="(navigateTD StoppingMedia)";stopMedia();if(vPlayAudioOn)StopAudio();if(TsIsSpeaking())TsStopSpeaking();if(typeof d.ETSGetSource=="function")d.ETSGetSource();itdCurrentLocation="(navigateTD StoppedMedia)"}itdCurrentLocation="(navigateTD IsXmlHttpSending)";if(vIsXmlHttpSending){navigateTDCallbackTimeout=window.setTimeout(function(){navigateTDCalledFromCallback=true;navigateTD.apply(this,c);navigateTDCalledFromCallback=false},500);itdCurrentLocation="(navigateTD IsXmlHttpSendingEnded)";return}if(typeof(d.ScoreLiveApplicationItems)!="undefined")d.ScoreLiveApplicationItems();if(d.vItemType!='HTMLSimulation'&&b!='quit'&&b!='refresh'&&b!='timeout'&&b!='swaplanguage'&&b!='swapcontentlanguage'&&b!='autorefresh'&&b!='exitsection'&&b!='proctornav'){itdCurrentLocation="(navigateTD validatePageNavigation)";var g=(typeof d.validatePageNavigation=="undefined")?1:d.validatePageNavigation();if(g==2){navigateTDCallbackTimeout=window.setTimeout(function(){navigateTDCalledFromCallback=true;navigateTD.apply(this,c);navigateTDCalledFromCallback=false},500);itdCurrentLocation="(navigateTD validatePage2Ended)";return}if(g==0){timerMode=f;itd.isNavigating=false;itd.itdLoadComplete=true;focusElementFrame();itdCurrentLocation="(navigateTD validatePage0Ended)";return}else if(!d.vConfirmAnswer&&!d.vReviewToCaller&&b.indexOf('gotoitem')==-1&&d.vUIType.toLowerCase()!='review'&&b!='return'){itdCurrentLocation="(navigateTD validateNavigation)";if(d.validateNavigation(b)==0){var h;var j;timerMode=f;itd.isNavigating=false;itd.itdLoadComplete=true;if(typeof(d.validateEssayNavigation)=="function"&&d.minLengthViolation&&typeof(displayEssayUnderMinLength)=="function"){h=d.document.getElementById(d.essayEditor.fieldName+d.essayEditor.id);j=h.getAttribute("minlength");displayEssayUnderMinLength(j)}else if(typeof(d.validateEssayNavigation)=="function"&&d.minWordViolation&&typeof(displayEssayUnderMinWords)=="function"){h=d.document.getElementById(d.essayEditor.fieldName+d.essayEditor.id);j=h.getAttribute("minwords");displayEssayUnderMinWords(j)}else if(typeof(displayRequiredMessage)=="function")displayRequiredMessage();focusElementFrame();itdCurrentLocation="(navigateTD validateNavigationEnded)";return}else if((typeof vProcessInvalidInputNumberItems=="undefined"||vProcessInvalidInputNumberItems)&&typeof validateInputNumberItems!="undefined"&&!validateInputNumberItems()){if(typeof displayInvalidInputNumber!="undefined")displayInvalidInputNumber();else ITDAlert(itd.INBadNumber);timerMode=f;itd.isNavigating=false;itd.itdLoadComplete=true;focusElementFrame();itdCurrentLocation="(navigateTD validateInputNumberEnded)";return}}}nav02Counter=0;itdCurrentLocation="(navigateTD disableButtons)";if(typeof(itd.frames["ControlPanelFrame"])!="undefined")itd.frames["ControlPanelFrame"].disableButtons();itdCurrentLocation="(navigateTD showNavGraphic)";if(typeof(showNavGraphic)=="function")showNavGraphic();itdCurrentLocation="(navigateTD setCursors)";if(typeof(setCursors)=="function")setCursors("wait");itdCurrentLocation="(navigateTD resetSearchBox)";if(typeof(resetSearchBox)=="function")resetSearchBox();itdCurrentLocation="(navigateTD updateTiming)";if(!updateTiming()){fatalSystemError('1001');return}if(!updateCurrentItemTiming(currentItemStartTimeIndex)){fatalSystemError('1901');return}itdCurrentLocation="(navigateTD ITDSetPageComplete)";ITDSetPageComplete();checkLiveTickCount=0;itdCurrentLocation="(navigateTD stopTiming)";stopTiming(false);itdCurrentLocation="(navigateTD clearTimeouts)";if(onLoadTimeout!=null){window.clearTimeout(onLoadTimeout);onLoadTimeout=null}if(setIdCursorOnTimeout!=null){window.clearTimeout(setIdCursorOnTimeout);setIdCursorOnTimeout=null}if(restoreSinglePassageTimeout!=null){window.clearTimeout(restoreSinglePassageTimeout);restoreSinglePassageTimeout=null}if(restoreMultiplePassageTimeout!=null){window.clearTimeout(restoreMultiplePassageTimeout);restoreMultiplePassageTimeout=null}if(setAnswerResponseTimeout!=null){window.clearTimeout(setAnswerResponseTimeout);setAnswerResponseTimeout=null}if(setPassageLinkTimeout!=null){window.clearTimeout(setPassageLinkTimeout);setPassageLinkTimeout=null}if(selectMarkerTimeout!=null){window.clearTimeout(selectMarkerTimeout);selectMarkerTimeout=null}if(toggleTargetSentenceGroupTimeout!=null){window.clearTimeout(toggleTargetSentenceGroupTimeout);toggleTargetSentenceGroupTimeout=null}if(loadInsertedSentenceTimeout!=null){window.clearTimeout(loadInsertedSentenceTimeout);loadInsertedSentenceTimeout=null}if(togglePassageSelectSolutionTimeout!=null){window.clearTimeout(togglePassageSelectSolutionTimeout);togglePassageSelectSolutionTimeout=null}if(toggleSentenceSolutionTimeout!=null){window.clearTimeout(toggleSentenceSolutionTimeout);toggleSentenceSolutionTimeout=null}if(ITDSetAnsweredStatusTimeout!=null){window.clearTimeout(ITDSetAnsweredStatusTimeout);ITDSetAnsweredStatusTimeout=null}if(ITDIllegalKeyShutdownTimeout!=null){window.clearTimeout(ITDIllegalKeyShutdownTimeout);ITDIllegalKeyShutdownTimeout=null}if(scoreDialogTimeout!=null){window.clearTimeout(scoreDialogTimeout);scoreDialogTimeout=null}itdCurrentLocation="(navigateTD ITDBeforeSubmit)";if(typeof d.ITDBeforeSubmit=="function")d.ITDBeforeSubmit();itdCurrentLocation="(navigateTD ITSStopStatusCheck)";if(typeof ITSStopStatusCheck=='function')ITSStopStatusCheck();itdCurrentLocation="(navigateTD ITSStopBackgroundSave)";if(typeof ITSStopBackgroundSave=='function')ITSStopBackgroundSave();itdCurrentLocation="(navigateTD ITSIncrementSaveCounter)";if(typeof ITSIncrementSaveCounter=='function')ITSIncrementSaveCounter();itdCurrentLocation="(navigateTD itdANSaveChanges)";if(typeof itdANSaveChanges=='function')itdANSaveChanges();itdCurrentLocation="(navigateTD itdSetActionElementString)";if(typeof itd.itdSetActionElementString=='function')itd.itdSetActionElementString();if(!d.vIsReview&&d.vItemType=='HTMLSimulation'){d.vTargetNext='ElementDisplayFrame';d.vTargetPrev='ElementDisplayFrame';d.CancelSaves();if(typeof d.GetAnswer=="function")d.ITDStoreAnswer(d.GetAnswer());if(typeof d.Score=="function")d.Score();if(typeof d.Terminate=="function")d.Terminate()}var k=false;var l=d.document.forms["ITD-ITEM"];if(b!='forceerror')action="itd.aspx?cmd="+a+'&data='+vQueryStringData+'&previouspage='+d.vItemName;else action="fakeerror.aspx?cmd="+a;var m='';var n='';if(arguments.length>navigateTD.length){for(var i=1;i<arguments.length;i++){var o=arguments[i].toLowerCase().indexOf("target=");var p=arguments[i].indexOf("navcmd=");var q=arguments[i].indexOf("navseq=");if(o!=-1){l.target=arguments[i].substring(o+7);k=true}else if(p!=-1){m=arguments[i].substring(p+7).toLowerCase()}else if(q!=-1){n=arguments[i].substring(q+7)}action+="&"+arguments[i]}}if(!k){if(b=='next'||b=='nextmarkcorrect'){l.target=d.vTargetNext}else if(b=='refresh'||b=='autorefresh'||b=='completesession'||b=='pausesession'||(b=='proctornav'&&(m=='~~refresh'||m=='~~completesession'||m=='~~pausesession'))){l.target='itdtop'}else if(b=='proctornav'){l.target='ElementDisplayFrame'}else if(b=='back'){l.target=d.vTargetPrev}else if(b=='scorereport'||b=='swaplanguage'||b=='scorereportrestart'){l.target='itdtop'}else if(b=='quit'||b=='pause'||(b=='proctornav'&&(m=='~~pause'||m=='~~quit'))){l.target='ElementDisplayFrame'}}itdCurrentLocation="(navigateTD PLResetQueuedNavigationCommand)";if(typeof(itdProctorNavigationCommand)!="undefined"&&itdProctorNavigationCommand!=null&&b=='proctornav'&&decodeURIComponent(m)==itdProctorNavigationCommand.toLowerCase()&&parseInt(decodeURIComponent(n))==parseInt(itdProctorNavigationSequence))PLResetQueuedNavigationCommand();if(l.target=='itdtop'){window.clearInterval(testTimer);action+="&annotations=1"}sentSolDisplayed=false;itdCurrentLocation="(navigateTD PassageReset)";if(d.vItemType=='PassageSelect')disablePassageSelect();else if(d.vItemType=='PassageHighlight')clearPreviousPassageHighlight();itdCurrentLocation="(navigateTD itdPassageClear)";if(d.itdPassageClear==true)clearPassage();itdCurrentLocation="(navigateTD clearPreviousMarker)";clearPreviousMarker();itdCurrentLocation="(navigateTD clearPreviousMedia)";clearPreviousMedia();itdCurrentLocation="(navigateTD clearPreviousSentence)";clearPreviousSentence();itdCurrentLocation="(navigateTD storeLastItem)";storeLastItem();if(d!=null){if(typeof(previousFrameScrolling)!="undefined"&&previousFrameScrolling!="notset"){d.frameElement.scrolling=previousFrameScrolling;previousFrameScrolling="notset"}}vItemKeys=null;vTotalItemKeys=0;itdCurrentLocation="(navigateTD PLNavigationBegin)";if(typeof(PLNavigationBegin)=="function")PLNavigationBegin();var r=b.indexOf("&");if(r>0)lastNavCMD=b.substr(0,r);else lastNavCMD=b;l.action=action;itdCurrentLocation="(navigateTD SubmitEnd)";itdItemLoadedStatus="Item Loading ";try{external.ClearClipboard()}catch(e){}itdActions=new Array();l.submit()}}function fix(a){var b;var c=a.toString();var d=c.indexOf(".");if(d!=-1){b=c.substring(0,d)}else{b=a}return b}function getMilliseconds(a,b,c){return(a*3600000)+(b*60000)+(c*1000)}function getTimeRemaining(a,b){return(a-b)}function ITDGetTotalTimeSpentForSave(){var a=totalTimeSpent();totalStartTime=ITDGetTickTime();return a}function ITDGetTimeSpentForSave(){if(timerMode==0||timerMode==4)return 0;var a=timeSpent();return a}function ITDDetermineTimeoutAction(a){switch(a){case 2:return true;break;case 1:elementFrame().document.forms[0].TimeoutAction.value=1;timerMode=2;timeSpentBeforePause=timeSpent();currentItemTimeSpentBeforePause=currentItemTimeSpent();stopTiming(false);return true;break;case-1:return false;break;default:window.navigateTD("timeout");return true;break}}function performTimeout(){awaitingTimeoutTimeSpent=timeSpent();awaitingTimeoutAction=true;var a=true;var b=elementFrame();setTime(convertMilliseconds(0),convertMilliseconds(0));try{if(typeof(BeforeLiveApplicationShutdown)=="function")BeforeLiveApplicationShutdown()}catch(e){}try{var b=elementFrame();if(b!=null&&typeof(b.ScoreLiveApplicationItems)!="undefined"){b.ScoreLiveApplicationItems();external.SetupApplicationWindow(0)}}catch(e){}try{if(typeof(AfterLiveApplicationShutdown)=="function")AfterLiveApplicationShutdown()}catch(e){}displayTimeoutMessage();unhandledTimeOut=false;if(typeof b.itdswfuIsUploading!="undefined"&&b.itdswfuIsUploading)a=false;if(typeof b.getTimeoutAction=="function")a=!ITDDetermineTimeoutAction(b.getTimeoutAction());if(a&&typeof getTimeoutAction=="function")a=!ITDDetermineTimeoutAction(getTimeoutAction());if(a)window.navigateTD("timeout");lastTickValue=ITDGetTickTime();awaitingTimeoutAction=false;return}function tick(){try{var a;var b;if(typeof elementFrame!="undefined")a=elementFrame();if(typeof PLCheckConnection=="function")PLCheckConnection();switch(timerMode){case 0:checkNavTime();var c=0;b=ITDGetTickTime();c=(b-loadingCheckTime);if(!onLoadCalled&&loadingCheckTime>0&&((!isStarting&&c>=30000)||c>=60000)){try{fatalSystemError('1002','','Navigation was not complete in sufficient time.',a.location.href,0)}catch(ex){fatalSystemError('1002')}return}if(typeof a!="undefined"&&a!=null){try{if(!itdIsChrome&&!itdIsSafari&&typeof a.document!="undefined"&&a.document.readyState=="complete"&&(typeof a.itdPageValidation=="undefined"||a.itdPageValidation!="loaded")){try{fatalSystemError('1007','','An unexpected document was loaded (typically an error page).',a.location.href,0)}catch(ex){fatalSystemError('1007')}return}}catch(ex){if(ex.number==-2147024891){try{fatalSystemError('1003','','A cross-site scripting error has occurred in attempting to access the element frame.',a.location.href,0)}catch(ex){fatalSystemError('1003')}return}}}break;case 1:var d=true;if(!itd.itdLoadComplete||itd.isNavigating)return;if(addTickErrorAction){addAction(255,(ITDGetTickTime()-startTickError),tickError,false);addTickErrorAction=false}var e=true;checkTickTime();if(a.vTimingEnabled){var f=getTimeRemaining(a.vMaxTimeAllowed,timeSpent());if(f>0){var g=getTimeRemaining(a.vMaxOverallTimeAllowed,timeSpent());setTime(convertMilliseconds(f),convertMilliseconds(g))}else{performTimeout();d=false}}if(d&&typeof vMaxInactiveTime!="undefined"&&vMaxInactiveTime>0&&typeof InactivityTimeout=="function"){var h=0;b=ITDGetTickTime();if(vLastActivity>0)h=(b-vLastActivity);else h=0;if(h>vMaxInactiveTime)InactivityTimeout()}break;case 2:break;case 3:break;case 4:break;default:break}}catch(tickEx){if(!addTickErrorAction){startTickError=ITDGetTickTime();tickError=tickEx;addTickErrorAction=true}}tickIsAlive=true;return}function queryElapsedTime(a){return timeSpent()+(a?0:elementFrame().vVisitTime)}var searchFrames=new Array();var searchDone=new Array();var framenum=new Array('1st','2nd','3rd','4th','5th');var itdIsSearching=false;function checkSearchExist(){searchFrames=new Array();findSearchFrame(itd);if(searchFrames.length>0)return true;else return false}function searchAll(a){if(!a){ITDAlert(itd.SENoText);return}if(searchFrames.length==0){findSearchFrame(itd)}for(var i=0;i<searchFrames.length;i++){if(searchDone[searchFrames[i]]=='n'){search(a,searchFrames[i],i);return}}}function clearFlag(){for(var i=0;i<searchFrames.length;i++)searchDone[searchFrames[i]]='n';itdLastRange=null}function findSearchFrame(a){var b=false;var c=null;try{c=a.searchMe}catch(e){c=null}if(c!=null){for(var i=0;i<searchFrames.length&&!b;i++)if(a.name==searchFrames[i])b=true;if(!b){searchFrames[i]=a.name;searchDone[a.name]='n'}}if(a.frames.length==0)return;else{for(var d=0;d<a.frames.length;d++){findSearchFrame(a.frames[d])}}}var itdLastRange=null;var itdLastSearchText="";function search(a,b,i){itdIsSearching=true;try{var c;var d=false;if(a!=itdLastSearchText)clearFlag();itdLastSearchText=a;var f=findFrame(itd,b);if(f){if(a){if(f.find){d=f.find(a)}else{var g=null;var h="";if(itdLastRange){c=itdLastRange;c.collapse(false)}else c=f.document.body.createTextRange();d=c.findText(a);if(d){c.select();itdLastRange=c}}if(!d){if(searchFrames.length==1)ITDAlert(itd.SENoMoreMatches);else ITDAlert(itd.SENoMoreMatchesInFrame.replace("%frame%",framenum[i]));searchDone[b]='y';if(i==searchFrames.length-1)clearFlag()}}else ITDAlert(itd.SENoText)}}catch(e){}itdIsSearching=false}function findFrame(a,b){if(a.name==b)return a;else if(a.frames.length==0)return false;else{for(var c=0;c<a.frames.length;c++){var d=findFrame(a.frames[c],b);if(d)return d}return false}}function findFrameByItemType(a,b){try{if(b=='Display'&&a.vItemType==b&&a.passageFrame)return a;else if(b!='Display'&&a.vItemType==b)return a;else if(a.frames.length==0)return false;else{for(var c=0;c<a.frames.length;c++){var d=findFrameByItemType(a.frames[c],b);if(d)return d}return false}}catch(e){}}var passageId=null;var last_passageId=null;var last_passageClass=null;var passageClass='';var passageOldClass='';var passageColor='';var colorIds='';var IdList=new Array();var IdCount=0;var autoPassageIds='';var passageIdList=new Array();var passageCount=0;function clearPassage(){var a=findFrameByItemType(itd,'ReadingPassage');var b;var c;var i;if(!a)a=findFrameByItemType(itd,'Display');if(a&&typeof(a.vContentLoaded)!="undefined"&&a.vContentLoaded){with(a){if(colorIds!=''){c=colorIds.split(',');for(i=0;i<c.length;i++){b=document.getElementById(c[i]);if(b){b.style.color=''}}}else if(passageId!=null){b=document.getElementById(passageId);if(b){b.className=passageOldClass}}if(autoPassageIds!=''){c=autoPassageIds.split(',');id_old=passageOldClass.split(',');for(i=0;i<c.length;i++){b=document.getElementById(c[i]);if(b){if(i<id_old.length&&id_old[i]!=null)b.className=id_old[i];else b.className=''}}}for(i=0;i<passageIdList.length;i++){b=document.getElementById(passageIdList[i]);if(b)b.className=''}}passageId=null;last_passageId=null;passageColor='';passageClass='';passageOldClass='';colorIds='';autoPassageIds='';passageIdList=new Array();passageCount=0}}function clearPassageSelectAnswers(){var a=elementFrame();clearPassage();if(a){for(var i=0;i<a.vItemTypeList.length;i++)if(a.vItemTypeList[i]=='PassageSelect'){a.document.forms[0].elements['R'+i].value="";break}}}function addPassageId(a){IdList[IdCount++]=a}function disablePassageSelect(){var a=findFrameByItemType(itd,'ReadingPassage');if(!a)a=findFrameByItemType(itd,'Display');if(a&&typeof(a.vContentLoaded)!="undefined"&&a.vContentLoaded){with(a){if(IdCount>0){for(var i=0;i<IdList.length;i++){var b=document.getElementById(IdList[i]);if(b)b.style.cursor=''}}}}clearPassage()}function initializePassage(){clearPassage();var a=elementFrame();for(var i=0;i<a.vItemTypeList.length;i++)if(a.vItemTypeList[i]=='PassageSelect'){var b=a.document.forms[0].elements['R'+i].value;if(b!=''){if(b.indexOf(',')==-1)restoreSinglePassage();else restoreMultiplePassage()}setIdCursorOn();break}}function setIdCursorOn(){if(setIdCursorOnTimeout!=null){window.clearTimeout(setIdCursorOnTimeout);setIdCursorOnTimeout=null}var a=findFrameByItemType(itd,'ReadingPassage');if(!a)a=findFrameByItemType(itd,'Display');var b=elementFrame().vItemName;if(a&&typeof(a.vContentLoaded)!="undefined"&&a.vContentLoaded){with(a){var c='pointer';for(var i=0;i<IdList.length;i++){var d=document.getElementById(IdList[i]);if(d){var e=d.getAttribute('items');if(e&&e.indexOf(b)!=-1)d.style.cursor=c;if(!e)d.style.cursor=c}}}}else{setIdCursorOnTimeout=window.setTimeout(function(){setIdCursorOn()},500)}}function restoreSinglePassage(){if(restoreSinglePassageTimeout!=null){window.clearTimeout(restoreSinglePassageTimeout);restoreSinglePassageTimeout=null}var a=findFrameByItemType(itd,'ReadingPassage');var b;var i;if(!a)a=findFrameByItemType(itd,'Display');if(a&&typeof(a.vContentLoaded)!="undefined"&&a.vContentLoaded){var c=elementFrame();var d=c.vItemName;var e='';for(i=0;i<c.vItemTypeList.length;i++){if(c.vItemTypeList[i]=='PassageSelect'){e=c.document.forms[0].elements['R'+i].value;break}}if(e!=''){for(i=0;i<IdList.length;i++){if(IdList[i]!=''){b=a.document.getElementById(IdList[i]);var f=b.getAttribute('items');var g=b.getAttribute('value');if(f&&f.indexOf(d)!=-1&&g&&g.indexOf(e)!=-1){f=f.replace(' ','');g=g.replace(' ','');var h=f.split(',');var k=g.split(',');for(var j=0;j<h.length;j++){if(h[j]==d&&k[j]==e){if(b.className!='ITSPassage')b.className='ITSPassage';passageId=IdList[i];last_passageId=IdList[i];passageIdList=IdList[i].split(',');passageCount=passageIdList.length;return}}}}}passageId=e;last_passageId=e;b=a.document.getElementById(passageId);if(b&&b.className!='ITSPassage')b.className='ITSPassage';passageIdList=e.split(',');passageCount=passageIdList.length}}else{restoreSinglePassageTimeout=window.setTimeout(function(){restoreSinglePassage()},500)}}function restoreMultiplePassage(){if(restoreMultiplePassageTimeout!=null){window.clearTimeout(restoreMultiplePassageTimeout);restoreMultiplePassageTimeout=null}var a=findFrameByItemType(itd,'ReadingPassage');var i;var b;if(!a)a=findFrameByItemType(itd,'Display');if(a&&typeof(a.vContentLoaded)!="undefined"&&a.vContentLoaded){var c=elementFrame();var d=c.vItemName;var e='';for(i=0;i<c.vItemTypeList.length;i++){if(c.vItemTypeList[i]=='PassageSelect'){e=c.document.forms[0].elements['R'+i].value;break}}if(e!=''){var f=e.split(',');passageIdList=e.split(',');var g=false;for(var z=0;z<f.length;z++){for(i=0;i<IdList.length;i++){b=a.document.getElementById(IdList[i]);var h=b.getAttribute('items');var k=b.getAttribute('value');if(h&&h.indexOf(d)!=-1&&k&&k.indexOf(f[z])!=-1){h=h.replace(' ','');k=k.replace(' ','');var l=h.split(',');var m=k.split(',');for(var j=0;j<l.length;j++){if(l[j]==d&&m[j]==f[z]){b.className='ITSPassage';g=true;passageIdList[z]=IdList[i]}}}}}if(!g){for(i=0;i<passageIdList.length;i++){b=a.document.getElementById(passageIdList[i]);if(b)b.className='ITSPassage'}}passageCount=passageIdList.length}}else{restoreMultiplePassageTimeout=window.setTimeout(function(){restoreMultiplePassage()},500)}}function setAnswer(a){var b=elementFrame();var i;if(b.vPageReadOnly)return;var c=b.vItemName;for(i=0;i<b.vItemTypeList.length;i++){if(b.vItemTypeList[i]=='PassageSelect'){if(b.vItemMaximumAllowed[i]>1){setAnswerMultiple(a);return}}}var d=findFrameByItemType(itd,'ReadingPassage');if(!d)d=findFrameByItemType(itd,'Display');var e='';if(d){var f=d.document.getElementById(a);if(f){var g=f.className;if(g.indexOf('Auto')!=-1)return;else if(f.style.cursor!='hand'&&f.style.cursor!='pointer')return;else{if(last_passageId!=null&&last_passageId!=a){var h=d.document.getElementById(last_passageId);if(h)h.className=''}f.className='ITSPassage';b.answerSelection[1]=1;var k=f.getAttribute('items');var l=f.getAttribute('value');if(k&&l){k=k.replace(' ','');l=l.replace(' ','');var m=k.split(',');var n=l.split(',');for(var j=0;j<m.length;j++){if(m[j]==c){e=n[j];break}}}}}}last_passageId=a;passageId=a;if(e=='')e=passageId;for(i=0;i<b.vItemTypeList.length;i++){if(b.vItemTypeList[i]=='PassageSelect'){b.document.forms[0].elements['R'+i].value=e;break}}}function setAnswerMultiple(a){var b=findFrameByItemType(itd,'ReadingPassage');var i;var c;if(!b)b=findFrameByItemType(itd,'Display');var d=elementFrame();var e=d.vItemName;if(b){c=b.document.getElementById(a);if(c){var f=c.className;if(f.indexOf('Auto')!=-1)return;else if(c.style.cursor!='hand'&&c.style.cursor!='pointer')return;else{if(c.className=='ITSPassage'){c.className='';d.answerSelection[1]--;var g=new Array();var h=0;for(i=0;i<passageIdList.length;i++)if(passageIdList[i]!=a)g[h++]=passageIdList[i];passageIdList=g;passageCount=passageIdList.length}else{c.className='ITSPassage';d.answerSelection[1]++;passageIdList[passageCount++]=a}}}}var k='';for(i=0;i<passageIdList.length;i++){c=b.document.getElementById(passageIdList[i]);var l=c.getAttribute('items');var m=c.getAttribute('value');if(l&&m){l=l.replace(' ','');m=m.replace(' ','');var n=l.split(',');var o=m.split(',');for(var j=0;j<n.length;j++){if(n[j]==e){if(k!='')k+=',';k+=o[j];break}}}}if(k=='')k=passageIdList.join(',');for(i=0;i<d.vItemTypeList.length;i++){if(d.vItemTypeList[i]=='PassageSelect'){d.document.forms[0].elements['R'+i].value=k;break}}}function setAnswerResponse(){if(setAnswerResponseTimeout!=null){window.clearTimeout(setAnswerResponseTimeout);setAnswerResponseTimeout=null}var a=elementFrame();if(a&&typeof(a.vContentLoaded)!="undefined"&&a.vContentLoaded){for(var i=0;i<a.vItemTypeList.length;i++){if(a.vItemTypeList[i]=='PassageSelect'){a.document.forms[0].elements['R'+i].value=passageId;break}}}else{setAnswerResponseTimeout=window.setTimeout(function(){setAnswerResponse()},500)}}function selectPassage(a){pageLink(a)}function setupAutoLink(a,b,c){last_passageId=null;passageId=null;if(b)passageClass+=b+',';else passageClass='';if(c){passageColor+=c+',';colorIds+=a+','}else passageColor='';autoPassageIds+=a+','}function autoLinkPassages(){selectPassageLink()}function pageLink(a){var b=itd.elementFrame();if(b.vPageReadOnly)return;last_passageId=passageId;last_passageClass=passageOldClass;passageId=a;passageColor='';passageClass='';passageOldClass='';setAnswerResponse();selectPassageLink()}function selectPassageLink(){var a;if(setPassageLinkTimeout!=null){window.clearTimeout(setPassageLinkTimeout);setPassageLinkTimeout=null}var b=findFrameByItemType(itd,'ReadingPassage');if(!b)b=findFrameByItemType(itd,'Display');if(b&&typeof(b.vContentLoaded)!="undefined"&&b.vContentLoaded){with(b){if(last_passageId!=null&&passageId!=last_passageId){a=document.getElementById(last_passageId);if(a)a.className=last_passageClass;last_passageClass='';last_passageId=''}if(passageId==null&&autoPassageIds!=''){var c=autoPassageIds.split(',');var d=passageColor.split(',');var e=passageClass.split(',');var f=passageOldClass.split(',');for(var i=0;i<c.length;i++){a=document.getElementById(c[i]);if(a){a.style.cursor='';var g='ITSPassage';if(passageClass)g=e[i];if(a.className!=g){if(f.length<(i+1))f[i]=a.className;a.className=g}if(i==0){var y;if(screen.Height>600)y=a.offsetTop-225;else y=a.offsetTop-140;var x=a.offsetLeft;vManualScroll=false;window.scrollTo(x,y)}}if(passageColor&&a)a.style.color=d[i]}passageOldClass=f.join();var h=elementFrame();if(typeof(h.itdPassagesAutoLinked)!="undefined"){h.itdPassagesAutoLinked=true}}else{a=document.getElementById(passageId);if(a&&a.className!='ITSPassage'){passageOldClass=a.className;a.className='ITSPassage'}}}}else{setPassageLinkTimeout=window.setTimeout(function(){selectPassageLink()},500)}}var vSelectedSource=null;var vSelectedSequence='';var vSelectedPos='';function initializeMatching(){vSelectedSource=null;vSelectedSequence='';vSelectedPos='';var a=elementFrame().vItemTypeList;for(var i=0;i<a.length;i++){if(a[i]=='Matching')populateMatchingAnswers(i)}}function populateMatchingAnswers(a){var b=elementFrame();var c=b.document.forms[0].elements['R'+a].value;if(c!=null&&c!=''){var d=c.split(',');var e=0;for(var i=0;i<d.length;i++){if(d[i]!=null&&d[i]!=''){e=e+1;var f=d[i].split('=');var g=b.document.getElementById('S'+a+'-'+f[1]);if(g){if(g.getAttribute('multiSelect')==null){if(g.getAttribute('dragEnabled')!=null)g.style.visibility='hidden';g.className='ITSMatchingSourceUsed'}var h=b.document.getElementById('T'+a+'-'+(i+1));if(h){var j;j=b.document.getElementById('SD'+a+'-'+(i+1));if(j==null){j=b.document.createElement('DIV');j.style.display='none';j.id='SD'+a+'-'+(i+1);j.innerHTML=h.innerHTML;j=h.parentNode.insertBefore(j,h)}h.innerHTML=g.innerHTML}}}}b.answerSelection[a]=e}}function selectSource(a,b,c){var d=elementFrame();if(d.vPageReadOnly)return;if(a.className=='ITSMatchingSourceUsed'){ITDAlert(itd.MATCHUsed);vSelectedSource=null;vSelectedSequence='';vSelectedPos=''}else{if(vSelectedSource&&vSelectedSource.className=='ITSMatchingSourceSelected')vSelectedSource.className='ITSMatchingSource';a.className='ITSMatchingSourceSelected';vSelectedSource=a;vSelectedSequence=b;vSelectedPos=c}}function selectTarget(a,b,c,d){var e=itd.elementFrame();if(e.vPageReadOnly)return;if(a.style.backgroundColor==vHighlightColor)return;if(vSelectedSequence!=c&&vSelectedSource!=null){ITDAlert(itd.MATCHInvalidSource);return}var f=e.document.forms[0].elements['R'+c].value;var g=f.split(',');var h;var i;var k;k=e.document.getElementById('SD'+c+'-'+d);if(k==null){k=e.document.createElement('DIV');k.style.display='none';k.id='SD'+c+'-'+d;k.innerHTML=a.innerHTML;k=a.parentNode.insertBefore(k,a)}if(vSelectedSource){if(vSelectedSource.getAttribute('multiSelect')==null){vSelectedSource.className='ITSMatchingSourceUsed'}if(a.innerHTML!=''){if(g.length>=d&&g[d-1]!=''){h=g[d-1].split('=');i=e.document.getElementById('S'+c+'-'+h[1]);if(i){i.className='ITSMatchingSource';i.style.visibility='visible'}}}if(f==''){var l=d;while(true){if(e.document.getElementById('T'+c+'-'+l)){l++}else{l--;break}}g=new Array(l)}g[d-1]=d+'='+vSelectedPos;a.innerHTML=vSelectedSource.innerHTML}else{if(g.length>=d&&g[d-1]!=''){h=g[d-1].split('=');i=e.document.getElementById('S'+c+'-'+h[1]);g[d-1]='';if(i){i.className='ITSMatchingSource';i.style.visibility='visible'}}a.innerHTML=k.innerHTML}e.document.forms[0].elements['R'+c].value=g.join(',');var m=0;for(var j=0;j<g.length;j++){if(g[j]!=null&&g[j]!='')m=m+1}e.answerSelection[c]=m;if(m>=e.vItemMinimumSelection[c])itd.ITDSetAnsweredStatus(e.vItemIds[c],'Answered');else itd.ITDSetAnsweredStatus(e.vItemIds[c],'Unanswered');vSelectedSource=null;vSelectedSequence='';vSelectedPos=''}function clearMatchingAnswers(){var e=elementFrame();if(e){vSelectedSource=null;vSelectedSequence='';vSelectedPos='';$(".ITSMatchingTarget",e.document).each(function(i){var a=$(this).attr("id");var b=a.indexOf("-");if(b>=0){var c=parseInt(a.substr(b+1));var d=parseInt(a.substr(1,b-1));selectTarget($(this).get(0),false,d,c)}})}}function buildAction(a,b,c){return a+','+b+','+c.replace(/,/g,"%2C")}var itdActions=new Array();function addAction(a,b,c,d){var e=buildAction(a,b,c);var f=false;var g=0;while(!f&&g<itdActions.length){if(itdActions[g].action==e){itdActions[g].count++;f=true}g++}if(!f){g=itdActions.length;itdActions[g]={action:e,count:1}}}function itdSetActionElementString(){var a=elementFrame();if(a&&a.document&&a.document.forms.length>0){var b=a.document.forms[0];if(b){var c=b.elements['Actions'];if(c){var d='';var i;for(i=0;i<itdActions.length;i++){var e=itdActions[i].action;if(itdActions.count>1)e+='%2C Count:'+itdActions[i].count.toString();if(d.length>0)d+=';'+e;else d=e}c.value=d}}}}var dragapproved=false;var drag_source=null;var dragObject=null;var mouseOffset=null;var drag_initialMouseX;var drag_initialMouseY;var drag_startX;var drag_startY;function getEventTarget(e){var a;if(!e)return null;if(e.target)a=e.target;else if(e.srcElement)a=e.srcElement;if(a.nodeType==3)a=a.parentNode;if(a!=null&&typeof(a.tagName)!="undefined"&&(a.tagName.toLowerCase()=="area"||a.tagName.toLowerCase()=="map")){while(a.tagName.toLowerCase()=="area")a=a.parentNode;a=getImgFromImgMap(a)}return a}var lastTouchPosition=null;function mouseCoords(a){var b=elementFrame();a=a||b.event;if(typeof(a.touches)!="undefined"&&a.touches.length==1){var c=a.touches[0];lastTouchPosition={x:c.pageX,y:c.pageY};return lastTouchPosition}else if(a.pageX||a.pageY){return{x:a.pageX,y:a.pageY}}var d=b.document.documentElement,body=b.document.body;var e=a.clientX+(d&&d.scrollLeft||body&&body.scrollLeft||0)-(d.clientLeft||0);var f=a.clientY+(d&&d.scrollTop||body&&body.scrollTop||0)-(d.clientTop||0);return{x:e,y:f}}function getImgFromImgMap(e){if(typeof(e.tagName)!="undefined"&&e.tagName.toLowerCase()=="map"){mapName="#"+e.name.toLowerCase();imgList=e.ownerDocument.getElementsByTagName("IMG");for(i=0;i<imgList.length;i++){if(imgList[i].useMap.toLowerCase()==mapName){return imgList[i];break}}}return e}function getPosition(e){var a=0;var b=0;var i;var c;var d;e=getImgFromImgMap(e);while(e.offsetParent){if(typeof(e.tagName)=="undefined"||(e.tagName.toLowerCase()!="map"&&e.tagName.toLowerCase()!="area")){a+=e.offsetLeft;b+=e.offsetTop}e=e.offsetParent;e=getImgFromImgMap(e)}a+=e.offsetLeft;b+=e.offsetTop;return{x:a,y:b}}function getMouseOffset(a,b){var c=elementFrame();b=b||c.event;var d=getPosition(a);var e=mouseCoords(b);return{x:e.x-d.x,y:e.y-d.y}}function move(a){if(dragapproved&&dragObject){var b=elementFrame();a=a||b.event;dragObject.style.position='absolute';dragObject.style.top=(drag_startY+a.clientY-drag_initialMouseY)+"px";dragObject.style.left=(drag_startX+a.clientX-drag_initialMouseX)+"px";return false}}function getMatchingEventSource(a){while(a&&a.className!='ITSMatchingSource')a=a.parentNode;return a}function drags(a){if(isNavigating||!itdLoadComplete)return;var b=elementFrame();a=a||b.event;if(b.vPageReadOnly)return;var c=getMatchingEventSource(getEventTarget(a));if(c&&c.className=='ITSMatchingSource'&&c.style.visibility!='hidden'){dragapproved=true;vIsDragging=true;var d=getPosition(c);drag_initialMouseX=a.clientX;drag_initialMouseY=a.clientY;drag_startX=d.x;drag_startY=d.y;drag_source=c;dragObject=c.cloneNode(true);dragObject.style.position='absolute';dragObject.style.top=(drag_startY+a.clientY-drag_initialMouseY)+"px";dragObject.style.left=(drag_startX+a.clientX-drag_initialMouseX)+"px";dragObject.style.height=c.offsetHeight;dragObject.style.width=c.offsetWidth;c.parentNode.appendChild(dragObject);drag_source.style.visibility='hidden';ITDAddEventSimple(b.document,"mousemove",move);ITDAddEventSimple(b.document,"touchmove",move);ITDAddEventSimple(b.document,"mouseout",dragmouseout);return false}else if(c&&c.className=='ITSMatchingTarget'){try{c.fireEvent('onclick')}catch(e){}}}function dragmouseout(a){var b=elementFrame();a=a?a:b.event;var c=a.relatedTarget||a.toElement;if(!c||c.nodeName=="HTML"){stop(a)}}function stop(a){dragapproved=false;vIsDragging=false;if(!drag_source)return;var b=elementFrame();a=a||b.event;ITDRemoveEventSimple(b.document,"mousemove",move);ITDRemoveEventSimple(b.document,"touchmove",move);ITDRemoveEventSimple(b.document,"mouseout",dragmouseout);var c=b.document.getElementsByTagName("div");var d=null;var e=0;var f=null;if(lastTouchPosition==null){f=mouseCoords(a)}else{f=lastTouchPosition;lastTouchPosition=null}for(var i=0;i<c.length;i++){if(c[i].className=='ITSMatchingTarget'){var g=getPosition(c[i]);var h=g.x;var j=g.y;var k=h+c[i].offsetWidth;var l=j+c[i].offsetHeight;if(f.x>=h&&f.x<=k&&f.y>=j&&f.y<=l){d=c[i];break}}}if(d&&d.style.backgroundColor!=vHighlightColor){vSelectedSource=drag_source;var m=drag_source.id;var n=m.replace('S','');n=n.split('-');vSelectedSequence=n[0];vSelectedPos=n[1];m=d.id;n=m.replace('T','');n=n.split('-');var o=n[0];var p=n[1];if(vSelectedSequence==o){selectTarget(d,false,o,p);drag_source.className='ITSMatchingSource';if(drag_source.getAttribute('multiSelect')==null)drag_source.style.visibility='hidden';else drag_source.style.visibility='visible'}else drag_source.style.visibility='visible'}else drag_source.style.visibility='visible';dragObject=drag_source.parentNode.removeChild(dragObject);dragObject=null;drag_source=null;vSelectedSource=null;vSelectedSequence='';vSelectedPos=''}var vMarkerIDList='';var vPreviousMarkerIDList='';function showMarker(a){if(a)vMarkerIDList+=a+',';selectMarker()}function selectMarker(){if(selectMarkerTimeout!=null){window.clearTimeout(selectMarkerTimeout);selectMarkerTimeout=null}if(vMarkerIDList=='')return;var a=findFrameByItemType(itd,'ReadingPassage');if(!a)a=findFrameByItemType(itd,'Display');if(a&&typeof(a.vContentLoaded)!="undefined"&&a.vContentLoaded){with(a){var b=vMarkerIDList.split(',');for(var i=0;i<b.length;i++){var c=document.getElementById(b[i]);if(c){c.style.display='inline';if(i==0){var y=c.offsetTop-55;var x=c.offsetLeft;vManualScroll=false;window.scrollTo(x,y)}}}vPreviousMarkerIDList=vMarkerIDList}}else{selectMarkerTimeout=window.setTimeout(function(){selectMarker()},500)}}function clearPreviousMarker(){if(vPreviousMarkerIDList=='')return;var a=findFrameByItemType(itd,'ReadingPassage');if(!a)a=findFrameByItemType(itd,'Display');if(a&&typeof(a.vContentLoaded)!="undefined"&&a.vContentLoaded){with(a){var b=vPreviousMarkerIDList.split(',');for(var i=0;i<b.length;i++){var c=document.getElementById(b[i]);if(c)c.style.display='none'}}}vPreviousMarkerIDList='';vMarkerIDList=''}function setDelay(a){var b,now;b=ITDGetTickTime();now=b;while((now-b)<a*1000){now=ITDGetTickTime()}}function hideHTML(a,b){var c=elementFrame();if(b)c=b;with(c){var d=document.getElementById(a);if(d)d.style.display='none';else ITDAlert(itd.HTMLHideFailed.replace("%id%",a))}}function showHTML(a,b){var c=elementFrame();if(b)c=b;with(c){var d=document.getElementById(a);if(d)d.style.display='block';else ITDAlert(itd.HTMLShowFailed.replace("%id%",a))}}function clearPreviousMedia(){if(audioTimer!=0){window.clearTimeout(audioTimer);audioTimer=0}if(mediaTimer!=0){window.clearTimeout(mediaTimer);mediaTimer=0}var i;var a;for(i=0;i<vMediaPlayers.playerIds.length;i++){a=vMediaPlayers[vMediaPlayers.playerIds[i]];if(a.mediaTimer!=null){window.clearTimeout(a.mediaTimer);a.mediaTimer=null}if(a.MEPlayer!=null){if(a.MEPlayer.playCheckTimer!=null)window.clearTimeout(a.MEPlayer.playCheckTimer);a.MEPlayer.playCheckTimer=null;a.MEPlayer.mediaStop=true;try{a.MEPlayer.remove()}catch(e){}}}vMediaPlayers={playerIds:new Array()};objCurrentMediaProgressBar=null;vMediaOffSet=0;vMediaTotalTime=null}function setMediaDuration(a){vMediaOffSet=0;vMediaTotalTime=a}var vLastVolume='';function setMediaVolume(a){ITDAddLog('setMediaVolume Begin');if(objCurrentMediaPlayer)objCurrentMediaPlayer.setVolume(a);vLastVolume=a;ITDAddLog('setMediaVolume End')}function readCookie(a){var b=document.cookie;var c=b.split(';');var d=c.length;var e;var f="";var x=0;for(x=0;((x<d)&&(f==""));x++){e=c[x].split('=');if(e[0].substring(0,1)==' '){e[0]=e[0].substring(1,e[0].length)}if(e[0]==a){f=e[1]}}return f}var vMediaPlayers={playerIds:new Array()};function startMedia(b,c,d,f,g){ITDAddLog('startMedia Begin');if(vPlayAudioOn)StopAudio();stopMedia(b);if(typeof(vMediaPlayers[b])=="undefined"){vMediaPlayers[b]={playerId:b,src:c,progressBarId:d,nextFunction:f,sourceFrame:g,MEPlayer:null,mediaTimer:0,replayCounter:0};vMediaPlayers.playerIds.push(b)}else{if(vMediaPlayers[b].src!=c)vMediaPlayers[b].replayCounter=0;vMediaPlayers[b].playerId=b;vMediaPlayers[b].src=c;vMediaPlayers[b].progressBarId=d;vMediaPlayers[b].nextFunction=f;vMediaPlayers[b].sourceFrame=g;vMediaPlayers[b].mediaTimer=null}if(itd.controlpanelloaded){var h=elementFrame();if(g)h=g;try{var i=c;if(vLastVolume=='')vLastVolume=1;setupMediaPlayerProgress(d,g);if(vMediaPlayers[b].MEPlayer==null){var j=h.document.getElementById(b);j['src']=i;objCurrentMediaPlayer=h.MediaElement(b,{pluginPath:'scripts/mediaelement/',flashName:'flashmediaelement-cdn.swf',success:function(a){a.addEventListener('playing',function(){a.allowEnd=true},false);a.addEventListener('timeupdate',function(){a.playCheck=true;if(a.allowEnd&&!a.mediaStop){updateMediaProgress(a.currentTime,a.duration,a.progressBarId)}},false);a.addEventListener('ended',function(){if(a.allowEnd){a.allowEnd=false;if(!a.mediaStop){updateMediaProgress(a.duration,a.duration,a.progressBarId);mediaFinishedPlaying(a.nextFunction)}}},false);a.playCheck=false;a.playCheckTimer=itd.setTimeout(function(){checkIfMediaPlaying(b)},30000);a.allowEnd=false;a.mediaStop=false;a.mediaPlaying=true;a.progressBarId=d;a.nextFunction=f;a.lastMedia=i;a.setVolume(vLastVolume);a.play()},error:function(){fatalSystemError('3001','','Error occurred loading the media player.','FramesetSkin.js',3001)}});vMediaPlayers[b].MEPlayer=objCurrentMediaPlayer}else{var k=vMediaPlayers[b].MEPlayer;objCurrentMediaPlayer=k;k.playCheck=false;k.playCheckTimer=itd.setTimeout(function(){checkIfMediaPlaying(b)},30000);k.nextFunction=f;if(k.tagName.toLowerCase()=="audio"||k.lastMedia!=i){k.setSrc(i);k.load();k.lastMedia=i}else{k.setCurrentTime(0)}k.setVolume(vLastVolume);k.play();k.mediaPlaying=true;k.mediaStop=false}}catch(e){fatalSystemError('3002','',e.message,'FramesetSkin.js',3002)}}else{vMediaPlayers[b].mediaTimer=itd.setTimeout(function(){delayMediaAction(b)},500)}ITDAddLog('startMedia End')}function checkIfMediaPlaying(a){ITDAddLog('checkIfMediaPlaying Begin');var b=vMediaPlayers[a];var c=false;if(b){if(b.mediaTimer)clearTimeout(b.mediaTimer);b.mediaTimer=null}try{if(b.MEPlayer){b.MEPlayer.playCheckTimer=null;c=b.MEPlayer.playCheck}}catch(e){c=false}if(!c){try{b.MEPlayer.remove()}catch(e){}b.replayCounter+=1;if(b.replayCounter<=5){b.MEPlayer=null;startMedia(b.playerId,b.src,b.progressBarId,b.nextFunction,b.sourceFrame)}else{fatalSystemError('3003','','Attempted to unsuccesfully replay five times.','FramesetSkin.js',3003)}}ITDAddLog('checkIfMediaPlaying End')}function delayMediaAction(a){ITDAddLog('delayMediaAction Begin');var b=vMediaPlayers[a];b.mediaTimer=null;if(itd.controlpanelloaded)startMedia(b.playerId,b.src,b.progressBarId,b.nextFunction,b.sourceFrame);else b.mediaTimer=itd.setTimeout(function(){delayMediaAction(a)},500);ITDAddLog('delayMediaAction End')}function setupMediaPlayerProgress(a,b){ITDAddLog('setupMediaPlayerProgress Begin');var c=elementFrame();try{if(b)c=b;with(c){if(a){objCurrentMediaProgressBar=document.getElementById(a);if(objCurrentMediaProgressBar)objCurrentMediaProgressBar.parentNode.style.display=''}else{if(objCurrentMediaProgressBar)objCurrentMediaProgressBar.parentNode.style.display='none';objCurrentMediaProgressBar=null}}if(objCurrentMediaProgressBar){var d=parseFloat(objCurrentMediaProgressBar.style.width);if(d>0)vMediaOffSet=d;else vMediaOffSet=0}}catch(e){ITDAlert(e.message)}ITDAddLog('setupMediaPlayerProgress End')}function clearMediaProgressBar(a){ITDAddLog('clearMediaProgressBar Begin');var b=elementFrame();with(b){if(a){objCurrentMediaProgressBar=document.getElementById(a);if(objCurrentMediaProgressBar){objCurrentMediaProgressBar.parentNode.style.display='';objCurrentMediaProgressBar.style.width=0}}else{if(objCurrentMediaProgressBar)objCurrentMediaProgressBar.parentNode.style.display='none';objCurrentMediaProgressBar=null}}ITDAddLog('clearMediaProgressBar End')}function stopMediaPlayer(a){ITDAddLog('stopMediaPlayer Begin');if(typeof(vMediaPlayers[a])!="undefined"){var b=vMediaPlayers[a];var c=b.MEPlayer;if(b){if(b.mediaTimer)clearTimeout(b.mediaTimer);b.mediaTimer=null}try{if(c){if(c.playCheckTimer!=null)clearTimeout(c.playCheckTimer);c.playCheckTimer=null}}catch(e){}if(c!=null){c.mediaPlaying=false;c.mediaStop=true;try{c.pause()}catch(e){}}}ITDAddLog('stopMediaPlayer End')}function stopMedia(){ITDAddLog('stopMedia Begin');if(arguments.length>0){stopMediaPlayer(arguments[0])}else{var i;for(i=0;i<vMediaPlayers.playerIds.length;i++){stopMediaPlayer(vMediaPlayers.playerIds[i])}}ITDAddLog('stopMedia End')}function updateMediaProgress(a,b,c){ITDAddLog('updateMediaProgress Begin');try{if(objCurrentMediaProgressBar){var d=0;var f=0;if(b>0){if(vMediaTotalTime){f=vMediaOffSet;d=(a/vMediaTotalTime)*100}else d=(a/b)*100}objCurrentMediaProgressBar.style.width=f+d+'%'}}catch(e){ITDAlert(e.message)}ITDAddLog('updateMediaProgress End')}function mediaFinishedPlaying(a){ITDAddLog('mediaFinishedPlaying Begin');try{if(a){if(a.indexOf('.')==-1){ITDAddLog('  Before Calling elementFrame().'+a);eval('elementFrame().'+a);ITDAddLog('  After Calling elementFrame().'+a)}else{ITDAddLog('  Before Calling '+a);eval(a);ITDAddLog('  After Calling '+a)}}}catch(e){ITDAlert(e.message)}ITDAddLog('mediaFinishedPlaying End')}var vBarStart,vBarTotal,vBarFunc;function pauseWithProgressBar(a,b,c,d){ITDAddLog('pauseWithProgressBar Begin');objCurrentMediaProgressBar=d.document.getElementById(b);vBarFunc=c;vBarStart=0;vBarTotal=a;displayStandaloneProgress();ITDAddLog('pauseWithProgressBar End')}function displayStandaloneProgress(){ITDAddLog('displayStandaloneProgress Begin');mediaTimer=0;vBarStart++;if(objCurrentMediaProgressBar)objCurrentMediaProgressBar.style.width=(vBarStart/vBarTotal)*100+'%';if(vBarStart<=vBarTotal)mediaTimer=itd.setTimeout(function(){displayStandaloneProgress()},1000);else eval(vBarFunc);ITDAddLog('displayStandaloneProgress End')}var vInsertSentenceGroup='';var objSourceSentence=null;var objLastTargetSentence=null;var vOriginalText='';function clearPreviousSentence(){var a=findFrameByItemType(itd,'ReadingPassage');if(a&&typeof(a.vContentLoaded)!="undefined"&&a.vContentLoaded){var b=a.document.getElementsByTagName('span');for(var i=0;i<b.length;i++){if(b[i].className=='ITSInsertTarget'&&b[i].style.display=='inline'){if(vOriginalText)b[i].innerHTML=vOriginalText;b[i].style.display='none'}}}}function setInsertSentence(){var a=elementFrame();var b=a.document.getElementsByTagName('span');vInsertSentenceGroup='';objSourceSentence=null;objLastTargetSentence=null;for(var i=0;i<b.length;i++){if(b[i].className=='ITSInsertSource'){vInsertSentenceGroup=b[i].getAttribute('group');objSourceSentence=b[i];break}}if(vInsertSentenceGroup){if(!itdLoadComplete)vSettingInsertSentence=true;toggleTargetSentenceGroup()}}function toggleTargetSentenceGroup(){if(toggleTargetSentenceGroupTimeout!=null){window.clearTimeout(toggleTargetSentenceGroupTimeout);toggleTargetSentenceGroupTimeout=null}var a=findFrameByItemType(itd,'ReadingPassage');if(a&&typeof(a.vContentLoaded)!="undefined"&&a.vContentLoaded){var b=a.document.getElementsByTagName('span');var c=null;for(var i=0;i<b.length;i++){if(b[i].className=='ITSInsertTarget'){if(b[i].getAttribute('group')==vInsertSentenceGroup){b[i].style.display='inline';c=b[i]}else b[i].style.display='none'}}if(c){var y=c.offsetTop-225;var x=c.offsetLeft;vManualScroll=false;a.scrollTo(x,y)}loadInsertedSentence()}else{toggleTargetSentenceGroupTimeout=window.setTimeout(function(){toggleTargetSentenceGroup()},500)}}function loadInsertedSentence(){if(loadInsertedSentenceTimeout!=null){window.clearTimeout(loadInsertedSentenceTimeout);loadInsertedSentenceTimeout=null}var a=itd.elementFrame();if(a&&typeof(a.vContentLoaded)!="undefined"&&a.vContentLoaded){var b=findFrameByItemType(itd,'ReadingPassage');var c=getSentenceResponse();var d=b.document.getElementsByTagName('span');vSettingInsertSentence=false;if(c=='')return;for(var i=0;i<d.length;i++){if(d[i].className=='ITSInsertTarget'){if(d[i].getAttribute('value')==c){insertSentence(d[i],c,true);return}}}}else{loadInsertedSentenceTimeout=window.setTimeout(function(){loadInsertedSentence()},500)}}function insertSentence(a,b){var c=elementFrame();if((sentSolDisplayed||c.vPageReadOnly)&&arguments.length==2)return;if(objSourceSentence){var d=a.innerHTML;if(vOriginalText!=''&&d.indexOf('/icon')==-1){objLastTargetSentence=null;a.innerHTML=vOriginalText;setSentenceResponse('');return}if(objLastTargetSentence)objLastTargetSentence.innerHTML=a.innerHTML;if(vOriginalText=='')vOriginalText=a.innerHTML;a.innerHTML=objSourceSentence.innerHTML;objLastTargetSentence=a;setSentenceResponse(b)}}function setSentenceResponse(a){var b=itd.elementFrame();for(var i=1;i<b.vItemTypeList.length;i++){if(b.vItemTypeList[i]=='InsertSentence'){b.document.forms[0].elements['R'+i].value=a;if(a!='')b.answerSelection[i]=1;else b.answerSelection[i]=0;break}}}function clearInputSentenceAnswers(){var a=findFrameByItemType(itd,'ReadingPassage');if(a&&typeof(a.vContentLoaded)!="undefined"&&a.vContentLoaded){var b=a.document.getElementsByTagName('span');$(".ITSInsertTarget",a.document).each(function(i){if($(this).html().indexOf("/icon")==-1)insertSentence($(this).get(0),"")})}}function getSentenceResponse(){var a=itd.elementFrame();var b='';for(var i=1;i<a.vItemTypeList.length;i++){if(a.vItemTypeList[i]=='InsertSentence'){b=a.document.forms[0].elements['R'+i].value;break}}return b}var vScrollWindow=null;var vManualScroll=true;function setScrollWindowSource(a){vScrollWindow=a}function monitorPageScroll(){if(isNavigating||!itdLoadComplete)return;if(vScrollWindow==null){ITDAlert(itd.SCROLLFailed);return}if(vScrollWindow.pageScrolled){}else if(vManualScroll){vScrollWindow.pageScrolled=true}if(!vManualScroll)vManualScroll=true;var a=0;var b=vScrollWindow.document.body.scrollHeight-vScrollWindow.document.body.clientHeight;var c=vScrollWindow.document.body.scrollTop;var d=itd.passageStatusFrame();if(d==null)return;if(c==a)d.Start();else if(c>a&&c<b)d.Middle();else if(c==b){d.End();elementFrame().blnBottomScrolled=true}}var objLastDef=null;var vDefBoxWidth=426;var vDefBoxTop='80%';function displayDefinition(a){closeDefinition();var b=createDefBox();b.innerHTML='<table style="border: solid 1px black" width="'+vDefBoxWidth+'" border="0" cellspacing="0" cellpadding="0" height="100%">'+'<tr><td style="font:bold 14px arial;color:#ffffff;background-color:#808080;border-bottom:solid 1px black" width="16" height="17">&nbsp;</td>'+'<td style="font:bold 14px arial;color:#ffffff;background-color:#808080;border-bottom:solid 1px black" align="center" width="394">Glossary</td>'+'<td style="font:bold 14px arial;color:#ffffff;background-color:#808080;border-bottom:solid 1px black;cursor:hand" width="16" height="17" onclick="itd.closeDefinition()"><img src="ITD/glossaryclose.gif" title="Click to close glossary" height="16" width="16" border="0" draggable="false" ondragstart="return false;" unselectable="on"></td></tr>'+'<tr><td>&nbsp;</td><td style="font:16px arial" align="center">'+decodeURIComponent(a)+'</td><td>&nbsp;</td></tr></table>';glossaryFrame().document.body.appendChild(b);objLastDef=b}function closeDefinition(){try{if(objLastDef)glossaryFrame().document.body.removeChild(objLastDef)}catch(e){}objLastDef=null}function createDefBox(){var a=glossaryFrame();var v=a.document.createElement('div');v.setAttribute('id','def1');v.style.position='absolute';v.style.left='0px';v.style.top=vDefBoxTop;v.style.width='100%';v.style.height='82px';v.style.textAlign='center';v.style.visibility='visible';return v}var vHighlightColor='yellow';function togglePassageSelectSolution(a){if(togglePassageSelectSolutionTimeout!=null){window.clearTimeout(togglePassageSelectSolutionTimeout);togglePassageSelectSolutionTimeout=null}var b=elementFrame();var c=b.vItemName;var d;with(b){for(var i=1;i<vItemTypeList.length;i++){if(vItemTypeList[i]=='PassageSelect'){var e=findFrameByItemType(itd,'ReadingPassage');if(typeof(e.vContentLoaded)=="undefined"||!e.vContentLoaded){if(a)togglePassageSelectSolutionTimeout=window.setTimeout(function(){itd.togglePassageSelectSolution(true)},100);else togglePassageSelectSolutionTimeout=window.setTimeout(function(){itd.togglePassageSelectSolution(false)},100);return}var f=document.forms[0].elements['Key'+i].value;var g=document.forms[0].elements['R'+i].value;var h=null;for(var z=0;z<IdList.length;z++){var k=e.document.getElementById(IdList[z]);var l=k.getAttribute('items');var m=k.getAttribute('value');if(l&&l.indexOf(c)!=-1&&m&&m.indexOf(f)!=-1){l=l.replace(' ','');m=m.replace(' ','');var n=l.split(',');var o=m.split(',');for(var j=0;j<n.length;j++){if(n[j]==c&&o[j]==f){h=k;break}}}}if(h==null)h=e.document.getElementById(f);if(a){if(f!=g){d=document.getElementById('solutionAnswer'+i);if(d)d.style.display='inline';d=document.getElementById('error'+i);if(d)d.style.display='inline';d=document.getElementById('check'+i);if(d)d.style.display='none'}else{d=document.getElementById('solutionAnswer'+i);if(d)d.style.display='none';d=document.getElementById('error'+i);if(d)d.style.display='none';d=document.getElementById('check'+i);if(d)d.style.display='inline'}}else{if(!vPageReadOnly){d=document.getElementById('solutionAnswer'+i);if(d)d.style.display='none';d=document.getElementById('error'+i);if(d)d.style.display='none';d=document.getElementById('check'+i);if(d)d.style.display='none'}}if(a){if(f==g){h.className='';h.style.backgroundColor=vHighlightColor}else{h.style.backgroundColor=vHighlightColor}}else{if(f==g){h.style.backgroundColor='';h.className='ITSPassage'}else{h.style.backgroundColor=''}}}}}}function toggleSentenceSolution(a){if(toggleSentenceSolutionTimeout!=null){window.clearTimeout(toggleSentenceSolutionTimeout);toggleSentenceSolutionTimeout=null}var b=elementFrame();var c;var i;var d;with(b){for(i=1;i<vItemTypeList.length;i++){if(vItemTypeList[i]=='InsertSentence'){var e=findFrameByItemType(itd,'ReadingPassage');if(vSettingInsertSentence||typeof(e.vContentLoaded)=="undefined"||!e.vContentLoaded){if(a)toggleSentenceSolutionTimeout=window.setTimeout(function(){itd.toggleSentenceSolution(true)},100);else toggleSentenceSolutionTimeout=window.setTimeout(function(){itd.toggleSentenceSolution(false)},100);return}if(a)d=document.forms[0].elements['Key'+i].value;else d=document.forms[0].elements['R'+i].value;var f=e.document.getElementsByTagName('span');for(var j=0;j<f.length;j++){if(f[j].className=='ITSInsertTarget'){if(d&&f[j].getAttribute('value')==d){if(vOriginalText=='')vOriginalText=f[j].innerHTML;f[j].innerHTML=objSourceSentence.innerHTML;if(a)f[j].style.backgroundColor=vHighlightColor;else f[j].style.backgroundColor='';break}}}if(a){if(document.forms[0].elements['R'+i].value!=document.forms[0].elements['Key'+i].value){c=document.getElementById('solutionAnswer'+i);if(c)c.style.display='inline';c=document.getElementById('error'+i);if(c)c.style.display='inline';c=document.getElementById('check'+i);if(c)c.style.display='none'}else{c=document.getElementById('solutionAnswer'+i);if(c)c.style.display='none';c=document.getElementById('error'+i);if(c)c.style.display='none';c=document.getElementById('check'+i);if(c)c.style.display='inline'}}else{if(!vPageReadOnly){c=document.getElementById('solutionAnswer'+i);if(c)c.style.display='none';c=document.getElementById('error'+i);if(c)c.style.display='none';c=document.getElementById('check'+i);if(c)c.style.display='none'}}}}if(a){sentSolDisplayed=true}else{sentSolDisplayed=false;for(i=1;i<vItemTypeList.length;i++){if(vItemTypeList[i]=='InsertSentence'){d=document.forms[0].elements['Key'+i].value;var g=document.forms[0].elements['R'+i].value;for(i=0;i<f.length;i++){if(f[i].className=='ITSInsertTarget'){if(d&&f[i].getAttribute('value')==d){if(d!=g){f[i].innerHTML=vOriginalText;f[i].style.backgroundColor=''}break}}}}}}}}function toggleMCOptionSolution(a){var b=elementFrame();with(b){for(var i=1;i<vItemTypeList.length;i++){if(vItemTypeList[i]=='MultipleChoice')if(vItemMaximumAllowed[i]>1)toggleMCOptionSolutionMultiple(a,i);else if(vItemMaximumAllowed[i]==1)toggleMCOptionSolutionSingle(a,i)}}}function toggleMCOptionSolutionMultiple(a,i){var b=elementFrame();var j;with(b){var c;var d;if(a)c=document.forms[0].elements['Key'+i].value;else c=document.forms[0].elements['R'+i].value;var e=c.split(',');var f;for(j=0;j<e.length;j++){if(a){f=document.getElementById('radio'+i+e[j]);if(f)f.style.backgroundColor=vHighlightColor}}if(a){var g=document.forms[0].elements['R'+i];var h='';if(g){if(typeof(g.value)=="undefined"){for(j=0;j<g.length;j++){if(g[j].checked){if(h.length>0)h+=','+g[j].value;else h+=g[j].value}}}else h=g.value}if(h!=document.forms[0].elements['Key'+i].value){d=document.getElementById('solutionAnswer'+i);if(d)d.style.display='inline';d=document.getElementById('error'+i);if(d)d.style.display='inline';d=document.getElementById('check'+i);if(d)d.style.display='none'}else{d=document.getElementById('solutionAnswer'+i);if(d)d.style.display='none';d=document.getElementById('error'+i);if(d)d.style.display='none';d=document.getElementById('check'+i);if(d)d.style.display='inline'}}else{if(!vPageReadOnly){d=document.getElementById('solutionAnswer'+i);if(d)d.style.display='none';d=document.getElementById('error'+i);if(d)d.style.display='none';d=document.getElementById('check'+i);if(d)d.style.display='none'}}if(!a){c=document.forms[0].elements['Key'+i].value;e=c.split(',');for(j=0;j<e.length;j++){f=document.getElementById('radio'+i+e[j]);if(f)f.style.backgroundColor=''}}}}function toggleMCOptionSolutionSingle(a,i){var b=elementFrame();with(b){var c;var d;var e;if(a)c=document.forms[0].elements['Key'+i].value;else c=document.forms[0].elements['R'+i].value;if(a){d=document.getElementById('radio'+i+c);if(d)d.style.backgroundColor=vHighlightColor}if(a){var f=document.forms[0].elements['R'+i];var g='';if(f){if(typeof(f.value)=="undefined"){for(j=0;j<f.length;j++){if(f[j].checked){if(g.length>0)g+=','+f[j].value;else g+=f[j].value}}}else g=f.value}if(g!=document.forms[0].elements['Key'+i].value){e=document.getElementById('solutionAnswer'+i);if(e)e.style.display='inline';e=document.getElementById('error'+i);if(e)e.style.display='inline';e=document.getElementById('check'+i);if(e)e.style.display='none'}else{e=document.getElementById('solutionAnswer'+i);if(e)e.style.display='none';e=document.getElementById('error'+i);if(e)e.style.display='none';e=document.getElementById('check'+i);if(e)e.style.display='inline'}}else{if(!vPageReadOnly){e=document.getElementById('solutionAnswer'+i);if(e)e.style.display='none';e=document.getElementById('error'+i);if(e)e.style.display='none';e=document.getElementById('check'+i);if(e)e.style.display='none'}}if(!a){c=document.forms[0].elements['Key'+i].value;d=document.getElementById('radio'+i+c);if(d)d.style.backgroundColor=''}}}function toggleMatrixSolution(a){var b=elementFrame();var c;var d;var i;var j;var e;with(b){for(i=1;i<vItemTypeList.length;i++){if(vItemTypeList[i]=='Matrix'){if(a)e=document.forms[0].elements['Key'+i].value;else e=document.forms[0].elements['R'+i].value;e=e.split(',');for(j=0;j<e.length;j++){d=document.getElementById(i+'-'+(j+1)+'-'+e[j]);if(d){if(a)d.innerHTML="<div style='background-color:"+vHighlightColor+"' align='center'><img src='ITD/checkmark.gif' draggable='false' ondragstart='return false;' unselectable='on'></div>";else{d.innerHTML='&nbsp;';d.style.backgroundImage="url('ITD/checkmark.gif')"}}}if(a){if(document.forms[0].elements['R'+i].value!=document.forms[0].elements['Key'+i].value){c=document.getElementById('solutionAnswer'+i);if(c)c.style.display='inline';c=document.getElementById('error'+i);if(c)c.style.display='inline';c=document.getElementById('check'+i);if(c)c.style.display='none'}else{c=document.getElementById('solutionAnswer'+i);if(c)c.style.display='none';c=document.getElementById('error'+i);if(c)c.style.display='none';c=document.getElementById('check'+i);if(c)c.style.display='inline'}}else{if(!vPageReadOnly){c=document.getElementById('solutionAnswer'+i);if(c)c.style.display='none';c=document.getElementById('error'+i);if(c)c.style.display='none';c=document.getElementById('check'+i);if(c)c.style.display='none'}}}}if(a){for(i=1;i<vItemTypeList.length;i++){if(vItemTypeList[i]=='Matrix'){e=document.forms[0].elements['R'+i].value;e=e.split(',');for(j=0;j<e.length;j++){d=document.getElementById(i+'-'+(j+1)+'-'+e[j]);if(d)d.style.backgroundImage=''}}}}else{for(i=1;i<vItemTypeList.length;i++){if(vItemTypeList[i]=='Matrix'){e=document.forms[0].elements['Key'+i].value;e=e.split(',');for(j=0;j<e.length;j++){d=document.getElementById(i+'-'+(j+1)+'-'+e[j]);if(d)d.innerHTML='&nbsp;'}}}}}}function makeUniqueTargetList(a){var b=a.split(',');var c='';var d='';var i;for(i=0;i<b.length;i++){var e=b[i].split("=");if(i==0){c+=e[1]+',';d=e[0]}else{if(e[0]!=d&&c.indexOf(e[1]+',')==-1){c+=e[1]+',';d=e[0]}}}c=c.split(',');var f='';for(i=0;i<c.length-1;i++){if(i>0)f+=',';f+=(i+1)+'='+c[i]}return f}function toggleMatchingSolution(a){var b=elementFrame();var c;var d;var i;var e;var f;with(b){for(i=1;i<vItemTypeList.length;i++){if(vItemTypeList[i]=='Matching'){var g;if(a)g=makeUniqueTargetList(document.forms[0].elements['Key'+i].value);else g=document.forms[0].elements['R'+i].value;e=g.split(',');for(j=0;j<e.length;j++){f=document.getElementById('T'+i+'-'+(j+1));if(f){if(a){if(e[j]!=''){c=e[j].split('=');c=document.getElementById('S'+i+'-'+c[1]);f.innerHTML=c.innerHTML;f.style.backgroundColor=vHighlightColor}}else{if(e[j]==''){f.innerHTML='&nbsp;'}else{c=e[j].split('=');c=document.getElementById('S'+i+'-'+c[1]);f.innerHTML=c.innerHTML;f.style.backgroundColor=''}}}}if(a){var h=document.forms[0].elements['R'+i].value;var k=document.forms[0].elements['Key'+i].value;var l=true;if(h=='')l=false;h=h.split(',');for(x=0;x<h.length;x++){if(k.indexOf(h[x])==-1||h[x]==''){l=false;break}}if(!l){d=document.getElementById('solutionAnswer'+i);if(d)d.style.display='inline';d=document.getElementById('error'+i);if(d)d.style.display='inline';d=document.getElementById('check'+i);if(d)d.style.display='none'}else{d=document.getElementById('solutionAnswer'+i);if(d)d.style.display='none';d=document.getElementById('error'+i);if(d)d.style.display='none';d=document.getElementById('check'+i);if(d)d.style.display='inline'}}else{if(!vPageReadOnly){d=document.getElementById('solutionAnswer'+i);if(d)d.style.display='none';d=document.getElementById('error'+i);if(d)d.style.display='none';d=document.getElementById('check'+i);if(d)d.style.display='none'}}}}if(a){}else{for(i=1;i<vItemTypeList.length;i++){if(vItemTypeList[i]=='Matching'){e=makeUniqueTargetList(document.forms[0].elements['Key'+i].value);e=e.split(',');for(j=0;j<e.length;j++){if(e[j]!=''){f=document.getElementById('T'+i+'-'+(j+1));if(f.style.backgroundColor){f.style.backgroundColor='';f.innerHTML='&nbsp;'}}}}}}}}function showCorrectness(){changeDisplayStyleByClass(elementFrame(),'div','s-isol','block')}function showDiagnostic(){changeDisplayStyleByClass(elementFrame(),'td','s-diag','block')}function changeDisplayStyleByClass(a,b,c,d){var e=a.document.getElementsByTagName(b);for(var i=0;i<e.length;i++){if(e[i].className==c){e[i].style.display=d;break}}}function setupPassageHighlights(){if(setupPassageHighlightsTimeout!=null){window.clearTimeout(setupPassageHighlightsTimeout);setupPassageHighlightsTimeout=null}var a=itd.elementFrame();if(a.vItemType=='PassageHighlight'){var b=findFrameByItemType(itd,'ReadingPassage');if(!b)b=findFrameByItemType(itd,'Display');if(b&&typeof(b.ITDPHSetupPassageHighlights)=="function")b.ITDPHSetupPassageHighlights();else setupPassageHighlightsTimeout=window.setTimeout(function(){setupPassageHighlights()},100)}}function clearPreviousPassageHighlight(){var a=itd.elementFrame();if(a.vItemType=='PassageHighlight'){var b=findFrameByItemType(itd,'ReadingPassage');if(!b)b=findFrameByItemType(itd,'Display');if(b&&typeof(b.ITDPHClearPreviousPassageHighlights)=="function")b.ITDPHClearPreviousPassageHighlights()}}function clearPassageHighlightAnswers(){var a=itd.elementFrame();if(a.vItemType=='PassageHighlight'){var b=findFrameByItemType(itd,'ReadingPassage');if(!b)b=findFrameByItemType(itd,'Display');if(b&&typeof(b.ITDPHClearPassageHighlightAnswer)=="function")b.ITDPHClearPassageHighlightAnswer()}}var vLastItem;var vLastKey;function storeLastItem(){var a=itd.elementFrame();vLastItem=a.vItemName;vLastKey=a.vPublishingKey}function markGroupOption(a,b,c,d,e){var f=elementFrame();if(f.vPageReadOnly)return;var g=c+'-'+a+'-'+b;var h=1;var j=b;while(true){if(f.document.getElementById(c+'-'+a+'-'+j))j--;else{j++;break}}var k=f.vNumGroups[c];var l=new Array(k);var m=f.document.forms[0].elements['R'+c].value;m=m.split(',');for(var i=0;i<k;i++)if(m[i])l[i]=m[i];else l[i]='';while(h){var n=c+'-'+a+'-'+j;var o=f.document.getElementById(n);if(o){if(n==g){if(e)o.style.backgroundImage='url('+e+')';else o.className=d+'On';l[a-1]=b}else{if(e)o.style.backgroundImage='';else o.className=d}}else{h=0}j++}f.document.forms[0].elements['R'+c].value=l.join(',');f.answerSelection[c]=l.join(',')}function restoreAnswerSelection(){var a=elementFrame();with(a){for(var i=0;i<vItemTypeList.length;i++)if(vItemTypeList[i].toLowerCase()=='matrix'||vItemTypeList[i].toLowerCase()=='optionselect')answerSelection[i]=document.forms[0].elements['R'+i].value}}var vAudioBrowserVersion=-1;var vRecStartTick=0;function QueryAudioBrowserVersion(){var a=ITDGetITSUI();if(a==null){if(vAudioBrowserVersion==-1){try{vAudioBrowserVersion=external.AudioBrowserVersion}catch(e){vAudioBrowserVersion=0}}}return vAudioBrowserVersion}function QueryVolume(){var a=ITDGetITSUI();if(a==null){try{return external.QueryVolume()}catch(e){}}return-1}function QueryWaveFormat(){var a=ITDGetITSUI();if(a==null){try{return external.QueryWaveFormat()}catch(e){}}else{return"wav"}return""}function CheckAudioProgress(){if(QueryAudioProgress()>=100){if(vPlayAudioOn){vPlayAudioOn=false;mediaFinishedPlaying(vNextFunc)}}if(vPlayAudioOn)audioTimer=window.setTimeout(function(){CheckAudioProgress()},100)}function PlayAudio(a){var b=ITDGetITSUI();try{stopMedia();if(b==null){external.PlayAudio(a);vPlayAudioOn=true}else{if(navigator.itdAudio)StopAudio();navigator.itdAudio=new Media(a);navigator.itdAudio.play();vPlayAudioOn=true}if(arguments.length>1){vNextFunc=arguments[1];audioTimer=window.setTimeout(function(){CheckAudioProgress()},100)}else vNextFunc=null;return 0}catch(e){}return 1}function QueryAudioLength(){var a=ITDGetITSUI();try{if(a==null){return external.QueryAudioLength()}else{if(navigator.itdAudio)return navigator.itdAudio.duration}}catch(e){}return-1}function QueryAudioProgress(){var a=ITDGetITSUI();try{if(a==null){var b=external.QueryAudioProgress();return b}else{if(navigator.itdAudio){var c=navigator.itdAudio.duration;if(c>0)return 100*(navigator.itdAudio.position/c);else return 100}}}catch(e){}return 0}function IsRecordingComplete(){return audioRecorded}function StopAudio(){var a=ITDGetITSUI();try{if(vPlayAudioOn&&audioTimer){clearTimeout(audioTimer)}vPlayAudioOn=false;if(a==null){external.StopAudio()}else{if(navigator.itdAudio)navigator.itdAudio.stop()}return 0}catch(e){}return 1}function WaitAudio(){var a=ITDGetITSUI();try{if(a==null){external.WaitAudio();vPlayAudioOn=false}return 0}catch(e){}return 1}function PauseAudio(){var a=ITDGetITSUI();if(a==null){try{external.PauseAudio();vPlayAudioOn=false;return 0}catch(e){}}else{if(navigator.itdAudio){navigator.itdAudio.pause();return 0}}return 1}function ContinueAudio(){var a=ITDGetITSUI();try{if(a==null){external.ContinueAudio();vPlayAudioOn=true}else{if(navigator.itdAudio){navigator.itdAudio.play()}}return 0}catch(e){}return 1}var itdRecordingFileName=null;var itdRecordingFilePath=null;function StartRecording(a,b){var c=ITDGetITSUI();if(c==null){var d=1;var f=0;var g=100;var h=navigator.platform.substr(0,3).toLowerCase()=="win"&&QueryAudioBrowserVersion()>=12;try{stopMedia();if(vPlayAudioOn)StopAudio();if(h){if(arguments.length>StartRecording.length){f=arguments[2];if(f==0&&arguments.length>(StartRecording.length+1))g=arguments[3];if(g<0||g>100)d=30}if(d==1){if(f==-1&&(a<0||a>2))a=1;audioType=a;audioRecording=true;vRecStartTick=ITDGetTickTime();d=external.StartRecording(a,b,f,g)}}else{if(arguments.length>StartRecording.length&&arguments[2]==0)d=30;else{audioType=a;audioRecording=true;vRecStartTick=ITDGetTickTime();d=external.StartRecording(a,b)}}}catch(e){audioRecording=false;d=1}}else{try{if(navigator.itdRecordAudio)DeleteRecording();itdRecordingFileName=elementFrame().vItemName+".wav";window.requestFileSystem(LocalFileSystem.PERSISTENT,0,gotFsForCreate,logError);audioType=0;audioRecording=true;d=0}catch(e){audioRecording=false;d=1}}return d}function StopRecording(){var a=ITDGetITSUI();if(a==null){try{var b=external.StopRecording();audioRecording=false;audioRecorded=true;try{if(QueryAudioBrowserVersion()>=12)addAction(101,(ITDGetTickTime()-vRecStartTick),"Recorded(v12+) Type = "+audioType+", Quality = "+external.QueryWaveFormat()+", Volume = "+external.QueryVolume(),false);else addAction(101,(ITDGetTickTime()-vRecStartTick),"Recorded(<v12) Type = "+audioType,false)}catch(e){}return b}catch(e){}}else{try{console.log("Stopping recording...");navigator.itdRecordAudio.stopRecord();audioRecording=false;audioRecorded=true;return 0}catch(e){}}return 1}function QueryRecordingName(){var a=ITDGetITSUI();if(a==null){try{return external.QueryRecordingName()}catch(e){}}else if(itdRecordingFilePath!=null){return itdRecordingFilePath}return""}function SaveRecording(){var a=ITDGetITSUI();try{var b=elementFrame();if(typeof b=="undefined")return 1;if(audioRecording)StopRecording();if(!audioRecorded)return-1;stopMedia();var c=location.protocol+"//"+location.host+location.pathname;var d=c.lastIndexOf("/");var f=c.substr(0,d+1)+"ITDAudioCapture.aspx?cmd=SAVE&data="+vQueryStringData+"&item="+b.vItemName+"&guid="+b.vGuid+"&code="+b.vCode+"&file="+b.vItemName;switch(audioType){case 0:f+='.wav';break;case 2:f+='.mp3';break;case 3:f+='.ogg';break;case 4:f+='.vox';break;case 5:f+='.au';break;case 6:f+='.aiff';break;case 7:f+='.m4a';break;case 8:f+='.flac';break;default:f+='.wma';break}var a=ITDGetITSUI();if(a==null){var g=external.SaveRecording(f);if(arguments.length>0){if(g==0)eval(arguments[0]+"(true);");else eval(arguments[0]+"(false);")}return g}else{a.SaveRecording(f,QueryRecordingName(),arguments[0]);return 0}}catch(e){}if(a==null&&arguments.length>0)eval(arguments[0]+"(false);");return 1}function DeleteRecording(){var a=ITDGetITSUI();if(a==null){try{audioRecorded=false;return external.DeleteRecording()}catch(e){}}else{try{audioRecorded=false;if(navigator.itdRecordAudio)window.requestFileSystem(LocalFileSystem.PERSISTENT,0,gotFsForDelete,logError);return 0}catch(e){}}return 1}function PauseRecording(){var a=ITDGetITSUI();if(a==null){try{if(audioType!=2)return external.PauseRecording()}catch(e){}}else{return StopRecording()}return 1}function ContinueRecording(){var a=ITDGetITSUI();if(a==null){try{if(audioType!=2)return external.ContinueRecording()}catch(e){}}else{return StartRecording()}return 1}function PlayRecording(){if(!audioRecorded)return-1;try{var a=QueryRecordingName();var b=[];b.push(a);for(i=0;i<arguments.length;i++)b.push(arguments[i]);return PlayAudio.apply(this,b)}catch(e){}return 1}function ReplayRecording(){try{var a=elementFrame();if(typeof a=="undefined")return 1;if(audioRecording)StopRecording();var b=location.protocol+"//"+location.host+location.pathname;var c=b.lastIndexOf("/");var d=b.substr(0,c+1)+"ITDAudioCapture.aspx?cmd=GET&data="+vQueryStringData+"&item="+a.vItemName+"&guid="+a.vGuid+"&code="+a.vCode;var f=a.vProgramId+'-'+a.vResultId+'-'+a.vItemName;if(arguments.length>0&&(navigator.platform.substr(0,3).toLowerCase()!="win"||QueryAudioBrowserVersion()>=12)){switch(arguments[0]){case 0:f+='.wav';break;case 2:f+='.mp3';break;case 3:f+='.ogg';break;case 4:f+='.vox';break;case 5:f+='.au';break;case 6:f+='.aiff';break;case 7:f+='.m4a';break;case 8:f+='.flac';break;default:f+='.wma';break}}else f+='.wma';return external.ReplayRecording(d,f)}catch(e){}return 1}function CheckFirewall(){var a=ITDGetITSUI();try{var b=location.protocol+"//"+location.host+location.pathname;var c=b.lastIndexOf("/");var d=b.substr(0,c+1)+"ITDCheckFirewall.aspx";if(a==null){var f=external.CheckFirewall(d);if(arguments.length>0){if(f==0){eval(arguments[0]+"(true);");return 0}else{eval(arguments[0]+"(false);");return 0}}return f}else{a.checkFirewall(d,arguments[0]);return 0}}catch(e){}if(a==null&&arguments.length>0)eval(arguments[0]+"(false);");return 1}function QueryBrowserPath(){try{return external.QueryBrowserPath()}catch(e){}return""}function AppCheckIfFilesInstalled(a,b){try{return external.AppCheckIfFilesInstalled(a,b)}catch(e){}return 0}function AppCheckIfFilesInPath(a){try{return external.AppCheckIfFilesInPath(a)}catch(e){}return 0}function AppRefreshFiles(a,b){try{external.AppRefreshFiles(a,b);return 1}catch(e){}return 0}function AppCopyFilesToUserPath(a,b){try{if(arguments.length>(AppCopyFilesToUserPath.length+1))external.AppCopyFilesToUserPath(a,b,arguments[2],arguments[3]);else if(arguments.length>AppCopyFilesToUserPath.length)external.AppCopyFilesToUserPath(a,b,arguments[2]);else external.AppCopyFilesToUserPath(a,b);return 1}catch(e){}return 0}function AppHide(a){try{external.AppHide(a);return 1}catch(e){}return 0}function AppShow(a){try{external.AppShow(a);return 1}catch(e){}return 0}function AppUnload(a){try{external.AppUnload(a);return 1}catch(e){}return 0}function AppUnloadAllDocuments(a){try{external.AppUnloadAllDocuments(a);return 1}catch(e){}return 0}function AppLoadDocuments(a,b){try{external.AppLoadDocuments(a,b);return 1}catch(e){}return 0}function AppRun(a,b){try{return external.AppRun(a,b)}catch(e){}return 0}function AppSetUserPath(a){try{external.AppSetUserPath(a);return 1}catch(e){}return 0}function AppSetLanguageCode(a){try{external.AppSetLanguageCode(a);return 1}catch(e){}return 0}function IsLayoutInstalled(a){try{return external.IsLayoutInstalled(a)}catch(e){}return 0}function ChangeKeyboardLayout(a,b,c,d,f){if(a!=null){try{a.focus()}catch(e){}}try{external.ChangeKeyboardLayout(b,c,d,f)}catch(e){return 0}if(a!=null){try{a.focus()}catch(e){}}return 1}function ITDInitializeReviewGroupItems(a){vReviewGroupItems=new Array();if(typeof InitializeReviewGroupItems=="function")InitializeReviewGroupItems(a)}function ITDUpdateReviewGroupItem(a,b,c,d,e){var f=0;var g=false;if(e!=null)g=true;if((g||a!=null)&&vReviewGroupItems.length>0){for(f=0;f<vReviewGroupItems.length;f++){if((g&&e==vReviewGroupItems[f].itemKey)||(!g&&a==vReviewGroupItems[f].itemName)){if(b!=null)vReviewGroupItems[f].answered=b;if(c!=null)vReviewGroupItems[f].marked=c;if(d!=null)vReviewGroupItems[f].visits=d;break}}if(typeof UpdateReviewGroupItem=="function"&&f<vReviewGroupItems.length)UpdateReviewGroupItem(f,vReviewGroupItems[f].itemName,vReviewGroupItems[f].answered,vReviewGroupItems[f].marked,vReviewGroupItems[f].visits,vReviewGroupItems[f].sequence,vReviewGroupItems[f].itemKey)}}function ITDAddReviewGroupItem(a,b,c,d,e,f){var g=0;if(a!=null){var h=vReviewGroupItems.length;vReviewGroupItems[h]={itemName:a,answered:b,marked:c,visits:d,sequence:e,itemKey:f};if(typeof AddReviewGroupItem=="function")AddReviewGroupItem(h,a,b,c,d,e,f)}}function ITDUpdateBackgroundCheckStatus(){var a=elementFrame();if(a!=null&&typeof(a.isPageComplete)=='function'){var b=a.isPageComplete();if(b&&typeof(PLQuestionComplete)=="function")PLQuestionComplete();if(b!=a.vComplete){a.vComplete=b;ITSForceBackgroundSave()}}}function ITDSetAnsweredStatus(a,b){ITDUpdateReviewGroupItem(a,b,null,null);var c=elementFrame();if(((typeof(vCheckSessionStatus)!="undefined"&&vCheckSessionStatus)||typeof(PLQuestionComplete)=="function")&&c!=null&&typeof(c.isPageComplete)=="function"){if(ITDSetAnsweredStatusTimeout!=null){window.clearTimeout(ITDSetAnsweredStatusTimeout);ITDSetAnsweredStatusTimeout=null}ITDSetAnsweredStatusTimeout=window.setTimeout(function(){ITDUpdateBackgroundCheckStatus()},10)}}function ITDSetMarkedStatus(a,b){ITDUpdateReviewGroupItem(a,null,b,null)}function ITDSetVisitStatus(a,b){ITDUpdateReviewGroupItem(a,null,null,b)}function ITDItemFocusChanged(a){if(typeof ItemFocusChanged=='function')ItemFocusChanged(a)}function clearAnswers(){var a=itd.elementFrame();if(a!=null&&typeof(a.clearAnswers)=='function')a.clearAnswers()}function isComplete(){var a=itd.elementFrame();var b=true;if(a!=null&&typeof(a.isPageComplete)=='function')b=a.isPageComplete();return b}function ITDGetOperatingSystem(){if(vThisOperatingSystem==-1){var a=navigator.userAgent.toLowerCase();if(a.indexOf("linux")!=-1)vThisOperatingSystem=3;else if(a.indexOf("x11")!=-1)vThisOperatingSystem=2;else if(a.indexOf("mac")!=-1)vThisOperatingSystem=1;else vThisOperatingSystem=0}return vThisOperatingSystem}function ITDGetBrowser(){if(vThisBrowser==-1){var a=navigator.userAgent.toLowerCase();if(a.indexOf("opera")!=-1)vThisBrowser=0;else if(a.indexOf("staroffice")!=-1)vThisBrowser=0;else if(a.indexOf("beonex")!=-1)vThisBrowser=0;else if(a.indexOf("chimera")!=-1)vThisBrowser=0;else if(a.indexOf("netpositive")!=-1)vThisBrowser=0;else if(a.indexOf("phoenix")!=-1)vThisBrowser=0;else if(a.indexOf("firefox")!=-1)vThisBrowser=1;else if(a.indexOf("applewebkit")!=-1)vThisBrowser=4;else if(a.indexOf("skipstone")!=-1)vThisBrowser=0;else if(a.indexOf("msie")!=-1)vThisBrowser=0;else if(a.indexOf("netscape")!=-1)vThisBrowser=2;else if(a.indexOf("mozilla/5.0")!=-1)vThisBrowser=3;else if(a.indexOf('\/')!=-1){if(a.substr(0,a.indexOf('\/'))!='mozilla')vThisBrowser=0;else vThisBrowser=2}else vThisBrowser=0}return vThisBrowser}function ITDGetWindowHeight(w){var a=0;if(typeof(w.innerHeight)=='number'){a=w.innerHeight}else if(w.document.documentElement&&(w.document.documentElement.clientWidth||w.document.documentElement.clientHeight)){a=w.document.documentElement.clientHeight}else if(w.document.body&&(w.document.body.clientWidth||w.document.body.clientHeight)){a=w.document.body.clientHeight}else{a=w.screen.availHeight}return a}function ITDGetWindowWidth(w){var a=0;if(typeof(w.innerWidth)=='number'){a=w.innerWidth}else if(w.document.documentElement&&(w.document.documentElement.clientWidth||w.document.documentElement.clientHeight)){a=w.document.documentElement.clientWidth}else if(w.document.body&&(w.document.body.clientWidth||w.document.body.clientHeight)){a=w.document.body.clientWidth}else{a=w.screen.availWidth}return a}function ITDGetKeyObject(a,b,c,d,e,f,g,h,i,j){var k=0;var l=null;var m=null;h=h.toLowerCase();if(g!=null)g=g.toLowerCase();if(f!=null)f=f.toLowerCase();if(h=="illegal")k=1;else if(h=="custom")k=2;if(g=="firefox")l=1;else if(g=="netscape")vBrowsers=2;else if(g=="mozilla")l=3;else if(g=="applewebkit")l=4;else if(g=="ie")l=0;if(f=="linux")m=3;else if(f=="unix")m=2;else if(f=="mac")m=1;else if(f=="win"||f=="windows")m=0;var n={KC:a,MKC:b,AK:c,CK:d,SK:e,OS:m,BW:l,ACT:k,MSG:i,CF:j};return n}function ITDAddTestKey(a,b,c,d,e,f,g,h,i,j){vTestKeys[vTotalTestKeys]=ITDGetKeyObject(a,b,c,d,e,f,g,h,i,j);vTotalTestKeys++}function ITDAddItemKey(a,b,c,d,e,f,g,h,i,j){if(vItemKeys==null)vItemKeys=new Array();vItemKeys[vTotalItemKeys]=ITDGetKeyObject(a,b,c,d,e,f,g,h,i,j);vTotalItemKeys++}function ITDIllegalKeyShutdown(){if(ITDIllegalKeyShutdownTimeout!=null){window.clearTimeout(ITDIllegalKeyShutdownTimeout);ITDIllegalKeyShutdownTimeout=null}if(!itd.isNavigating&&itd.itdLoadComplete&&itd.controlpanelloaded&&itd.infopanelloaded)navigateTD('quit');else ITDIllegalKeyShutdownTimeout=window.setTimeout(function(){ITDIllegalKeyShutdown()},100)}function ITDHandleIllegalKeys(a){if(window.opener&&vStartTest&&typeof window.opener.cancelMonitoring!="undefined")window.opener.cancelMonitoring();if(a)ITDAlert(a);if(window.opener&&vStartTest)window.opener.location=window.opener.location.href.replace("cmd=sessionhome","cmd=checkpending&request=1");ITDIllegalKeyShutdown()}function ITDGetFakeKeystrokeEvent(e){e=(e)?e:((event)?event:null);var a=(e.target)?e.target:e.srcElement;var b=e.keyCode;var c=e.altKey;var d=e.ctrlKey;var f=e.shiftKey;var g=e.modifiers;if(typeof e.which!="undefined"&&(!b||b==0))b=e.which;var h=b;if(typeof e.modifiers!="undefined"){c=((e.modifiers&1)==1);d=((e.modifiers&2)==2);f=((e.modifiers&4)==4)}else g=c+(d*2)+(f*4);if(!d&&!c&&(b>=97&&b<=122))h=(b>=97&&b<=122)?(b&95):b;if(ITDGetBrowser()==3&&ITDGetOperatingSystem()==1&&navigator.userAgent.indexOf("1.3")!=-1&&e.keyCode==0&&!f&&!c&&(b>=97&&b<=122))b=(b>=97&&b<=122)?(b&95):b;var i={srcElement:a,target:a,keyCode:b,which:b,modifiedKeyCode:h,altKey:c,shiftKey:f,ctrlKey:d,modifiers:g};return i}function ITDHandleKey(e,k){var a=true;if((k.KC!=null&&k.KC!=e.keyCode)||(k.MKC!=null&&k.MKC!=e.modifiedKeyCode)||(k.AK!=null&&((k.AK&&!e.altKey)||(!k.AK&&e.altKey)))||(k.CK!=null&&((k.CK&&!e.ctrlKey)||(!k.CK&&e.ctrlKey)))||(k.SK!=null&&((k.SK&&!e.shiftKey)||(!k.SK&&e.shiftKey)))||(k.OS!=null&&k.OS!=ITDGetOperatingSystem())||(k.BW!=null&&k.BW!=ITDGetBrowser()))a=false;if(a){var b='KeyCode:'+e.keyCode+', ModifiedKeyCode:'+e.modifiedKeyCode+', AltKey:'+e.altKey+', CtrlKey:'+e.ctrlKey+', ShiftKey:'+e.shiftKey+', OperatingSystem:'+ITDGetOperatingSystem()+', Browser:'+ITDGetBrowser();switch(k.ACT){case 1:ITDHandleIllegalKeys(k.MSG);addAction(201,0,b,false);a=true;break;case 2:if(k.MSG!=null)ITDAlert(k.MSG);if(k.CF!=null)a=eval(k.CF);else a=false;addAction(202,0,b,false);break;default:if(k.MSG!=null)ITDAlert(k.MSG);a=true;addAction(203,0,b,false);break}}return a}function ITDHandleKeys(e){var i;for(i=0;i<vTotalItemKeys;i++){if(ITDHandleKey(e,vItemKeys[i]))return true}for(i=0;i<vTotalTestKeys;i++){if(ITDHandleKey(e,vTestKeys[i]))return true}return false}function ITDKeyHandler(e){var a=null;ITDResetLastActivity();if(typeof elementFrame=="function")a=elementFrame();e=(e)?e:((event)?event:null);var b=ITDGetFakeKeystrokeEvent(e);if(b.keyCode==27){if(!blnBlockEscape){if(objCurrentMediaPlayer){objCurrentMediaPlayer.setCurrentTime(objCurrentMediaPlayer.duration)}}if(!blnBlockEscape&&TsIsSpeaking())TsStopSpeaking();return CancelEvent(e)}else if(b.shiftKey&&b.ctrlKey&&!b.altKey&&b.keyCode==32){if(a){var c=a.vItemType.toLowerCase();if(c=='essay'||c=='essayselect')return}blnBlockEscape=!blnBlockEscape;if(!blnBlockEscape)ITDAlert(itd.ESCAPEEnabled);else ITDAlert(itd.ESCAPEDisabled);return CancelEvent(e)}else if(b.keyCode==8){var d=','+b.srcElement.type+',';if(",application/x-shockwave-flash,email,number,password,search,tel,text,textarea,".indexOf(d)==-1)return CancelEvent(e)}else if(b.keyCode==116&&!b.shiftKey&&!b.altKey){return CancelRefresh(e)}else if(b.ctrlKey&&b.altKey&&b.modifiedKeyCode==84&&a){navigateTD("forceerror")}else if(b.ctrlKey&&b.altKey&&b.modifiedKeyCode==67&&a){var f="next";if(itd.location.protocol.substr(0,3)=='itd')f="crash";else vQueryStringData='BAD';navigateTD(f)}else if(b.ctrlKey&&b.shiftKey&&b.keyCode==118){ITDShowLog()}else if(b.ctrlKey&&b.shiftKey&&b.keyCode==114){var g;if(a&&(a.vScoreDialog||blnWorkShopPreview)){if(window.showModelessDialog){g='dialogWidth='+parseInt(window.screen.availWidth*vPopupWidth)+'px;dialogHeight='+parseInt(window.screen.availHeight*vPopupWidth)+'px;center:yes;resizable:yes';var h=window.showModelessDialog("itd.aspx?cmd=scoredialog&data="+vQueryStringData,window,g)}else{window.itd.captureEvents(Event.CLICK|Event.FOCUS);window.itd.onfocus=HandleFocus;var i=parseInt(window.screen.availHeight*vPopupRemainder/2);var j=parseInt(window.screen.availWidth*vPopupRemainder/2);g='dependent=yes,top='+i+',left='+j+',height='+parseInt(window.screen.availHeight*vPopupWidth)+',width='+parseInt(window.screen.availWidth*vPopupWidth)+'location=no,menubar=no,toolbar=no,status=yes';vScoreDialogWindow=window.open("itd.aspx?cmd=scoredialog&data="+vQueryStringData,"ScoreDialog",g);vScoreDialogWindow.focus()}}return CancelEvent(e)}else{var k=ITDHandleKeys(b);if(!k&&a&&typeof a.ITDCustomKeyHandler=="function")k=a.ITDCustomKeyHandler(b);if(!k&&typeof itd.ITDCustomKeyHandler=="function")k=itd.ITDCustomKeyHandler(b);if(!k&&a&&typeof a.ITDHandleItemKeystroke=="function")k=a.ITDHandleItemKeystroke(b);if(k)return CancelEvent(e);if(typeof itd.handleAdditionalKeys=="function")return itd.handleAdditionalKeys(e)}}function CancelEvent(e){if(e.stopPropagation){e.stopPropagation();e.preventDefault()}else{e.cancelBubble=true;e.returnValue=false;if(typeof e.keyCode!="undefined"){try{e.keyCode=0}catch(e){}}return false}return false}function CancelRefresh(e){CancelEvent(e);itd.navigateTD('refresh');return false}function HandleFocus(){if(vScoreDialogWindow){if(!vScoreDialogWindow.closed){if(scoreDialogTimeout!=null){window.clearTimeout(scoreDialogTimeout);scoreDialogTimeout=null}scoreDialogTimeout=window.setTimeout(function(){vScoreDialogWindow.focus()},60000)}else{window.itd.releaseEvents(Event.CLICK|Event.FOCUS);window.itd.onclick=""}}return false}function taOnKeyDown(w,e,a){w=(w)?w:window;e=(e)?e:((w.event)?w.event:null);ITDResetLastActivity();maxLength=a.getAttribute("maxlength");var b=w.event?e.keyCode:e.which;if((b==32)||(b==13)||(b>47)){if(maxLength&&(a.value.length>(maxLength-1))){if(w.event){e.returnValue=null}else{e.cancelDefault}return false}}return true}function taAdjustMaxLength(w,a){w=(w)?w:window;maxLength=a.getAttribute("maxlength");if(maxLength&&a.value.length>maxLength){a.value=a.value.substr(0,maxLength);if(typeof(displayEssayExceedsMaxLength)=="function")displayEssayExceedsMaxLength(maxLength)}sr=a.getAttribute("showremain");if(sr){w.document.getElementById(sr).innerHTML=maxLength-a.value.length}}function taOnPaste(w,a){w=(w)?w:window;var b=a.getAttribute("maxlength");if(b){if((w.event)&&(navigator.userAgent.toLowerCase().indexOf("safari")==-1)){var c=a.document.selection.createRange();var d=b-a.value.length+c.text.length;try{var e=w.clipboardData.getData("Text").substr(0,d);c.text=e}catch(err){}if(w.event){w.event.returnValue=null}else{a.value=a.value.substr(0,b);return false}}}return true}var vIsSecureBrowserSet=false;var vIsSecureBrowser=false;function ITDIsSecureBrowser(){if(!vIsSecureBrowserSet){if(navigator.userAgent.toLowerCase().indexOf("securebrowser")!=-1)vIsSecureBrowser=true;else{try{vIsSecureBrowser=external.IsSecureBrowser}catch(e){}}vIsSecureBrowserSet=true}return vIsSecureBrowser}function IsSecureBrowser(){return ITDIsSecureBrowser()}function IsHybridSecureBrowser(){if(ITDIsSecureBrowser()){try{return external.IsHybridSecureBrowser}catch(e){}}return false}function GetSecureBrowserVersion(){if(ITDIsSecureBrowser()){try{return external.GetSecureBrowserVersion()}catch(e){}}return""}function GetSecureBrowserType(){if(ITDIsSecureBrowser()){try{return external.GetSecureBrowserType()}catch(e){}}return""}function IsApplicationRunning(){if(ITDIsSecureBrowser()){try{return external.IsApplicationRunning()}catch(e){}}return false}function IsBlacklistProcessRunning(){if(ITDIsSecureBrowser()){try{return external.IsBlacklistProcessRunning()}catch(e){}}return false}function GetProcesses(){if(ITDIsSecureBrowser()){try{return external.GetProcesses()}catch(e){}}return"<Processes />"}function EnableSecurity(){if(ITDIsSecureBrowser()){try{return external.EnableSecurity()}catch(e){}}}function ConfigureSecurity(a,b,c,d){if(ITDIsSecureBrowser()){try{return external.ConfigureSecurity(a,b,c,d)}catch(e){}}}function ConfigureWhitelist(a){if(ITDIsSecureBrowser()){try{return external.ConfigureWhitelist(a)}catch(e){}}}function ConfigureBlacklist(a){if(ITDIsSecureBrowser()){try{return external.ConfigureBlacklist(a)}catch(e){}}}function ConfigureAllowTaskSwitching(a){if(ITDIsSecureBrowser()){try{return external.ConfigureAllowTaskSwitching(a)}catch(e){}}}function ConfigureAllowVirtualMachine(a){if(ITDIsSecureBrowser()){try{return external.ConfigureAllowVirtualMachine(a)}catch(e){}}}function ConfigureExitIfBlacklistNotPaused(a){if(ITDIsSecureBrowser()){try{return external.ConfigureExitIfBlacklistNotPaused(a)}catch(e){}}}function ConfigureExitIfApplicationNotPaused(a){if(ITDIsSecureBrowser()){try{return external.ConfigureExitIfApplicationNotPaused(a)}catch(e){}}}function SetLanguageText(a,b){if(ITDIsSecureBrowser()){try{return external.SetLanguageText(a,b)}catch(e){}}}function DisableSecurity(){if(ITDIsSecureBrowser()){try{return external.DisableSecurity()}catch(e){}}}function IsSecurityEnabled(){if(ITDIsSecureBrowser()){try{return external.IsSecurityEnabled}catch(e){}}return false}function GetVariable(a){if(typeof(itdVariables.hasOwnProperty)=="undefined"||itdVariables.hasOwnProperty(a))return itdVariables[a];else return null}function SetVariable(a,b){var c=elementFrame();if(c){var d=c.document.forms[0];var e=d.Variables.value;if(e.length>0){var f=encodeURIComponent(a)+'=';var g=(','+e).indexOf(','+f);if(g!=-1){var h=g+f.length;var i=e.indexOf(',',h);if(i!=-1){e=e.substr(0,h)+encodeURIComponent(b)+e.substr(i)}else e=e.substr(0,h)+encodeURIComponent(b)}else e+=','+encodeURIComponent(a)+'='+encodeURIComponent(b)}else e=encodeURIComponent(a)+'='+encodeURIComponent(b);d.Variables.value=e}itdVariables[a]=b}function TsIsSpeechSynthesisSupported(){if(typeof(SpeechSynthesis)!="undefined"&&SpeechSynthesis.IsSupported())return true;return false}function TsIsSupported(){if(TsIsSpeechSynthesisSupported()){return true}else if(ITDIsSecureBrowser()){var a=false;switch(ITDGetOperatingSystem()){case 1:try{a=TextToSpeech.IsSupported();return a}catch(e){}break;default:try{a=external.TextToSpeech.IsSupported;return a}catch(e){}break}}return false}function TsIsSpeaking(){var a=ttsPlaying;if(TsIsSpeechSynthesisSupported()){try{a=SpeechSynthesis.IsSpeaking()}catch(e){a=ttsPlaying}}else if(ITDIsSecureBrowser()){switch(ITDGetOperatingSystem()){case 1:try{a=TextToSpeech.IsSpeaking()}catch(e){a=ttsPlaying}break;default:try{a=external.TextToSpeech.IsSpeaking}catch(e){a=ttsPlaying}break}}return a}function TsStopSpeaking(){ttsPlaying=false;if(TsIsSpeechSynthesisSupported()){try{SpeechSynthesis.StopSpeaking()}catch(e){}}else if(ITDIsSecureBrowser()){switch(ITDGetOperatingSystem()){case 1:try{TextToSpeech.StopSpeaking()}catch(e){}break;default:try{external.TextToSpeech.StopSpeaking()}catch(e){}break}}}function TsStartSpeakingText(a){if(TsIsSpeechSynthesisSupported()){try{SpeechSynthesis.StartSpeakingText(a)}catch(e){}}else if(ITDIsSecureBrowser()){if(TsIsSpeaking())TsStopSpeaking();ttsPlaying=true;switch(ITDGetOperatingSystem()){case 1:try{TextToSpeech.StartSpeakingText(a)}catch(e){}break;default:try{external.TextToSpeech.StartSpeakingText(a)}catch(e){}break}}}function TsPlayPart(a){if(TsIsSupported()){var b=elementFrame();if(typeof(b)!="undefined"&&typeof(b.vTextToSpeak)!="undefined"){var c="";var d=b.vTextToSpeak;if(a<d.length){if(d[a].isOption){var e=d[a].optionSeq;var f=String.fromCharCode(e+64);if(typeof(speech_beforeoption)!="undefined")c+=speech_beforeoption.replace("%numseq%",e.toString()).replace("%alphaseq%",f)+" "}c+=d[a].speechText}TsStartSpeakingText(c)}}else if(typeof(DisplayTextToSpeechUnsupported)=="function")DisplayTextToSpeechUnsupported()}function TsPlayQuestion(){if(TsIsSpeechSynthesisSupported()||ITDIsSecureBrowser()){var a=elementFrame();if(typeof(a)!="undefined"&&typeof(a.vTextToSpeak)!="undefined"){var b="";var c=a.vTextToSpeak;var i=0;if(typeof(speech_beforequestion)!="undefined")b=speech_beforequestion;for(i=0;i<c.length;i++){var d;if(b.length>0)b+="\r\n";if(typeof(a.vTTSOrder)!="undefined")d=c[a.vTTSOrder[i]];else d=c[i];if(d.isOption){var e=d.optionSeq;var f=String.fromCharCode(e+64);if(typeof(speech_beforeoption)!="undefined")b+=speech_beforeoption.replace("%numseq%",e.toString()).replace("%alphaseq%",f)+" "}b+=d.speechText}if(typeof(speech_afterquestion)!="undefined")b+="\r\n"+speech_afterquestion;TsStartSpeakingText(b)}}}function TsGetVoices(){var a='';if(TsIsSpeechSynthesisSupported()){try{a=SpeechSynthesis.GetVoices()}catch(e){vIsSpeaking=ttsPlaying}}else if(ITDIsSecureBrowser()){switch(ITDGetOperatingSystem()){case 1:try{a=TextToSpeech.GetVoices()}catch(e){}break;default:try{a=external.TextToSpeech.GetVoices()}catch(e){}break}}return a}function TsQueryNumVoices(){var a=0;try{a=TsGetVoices().split(",").length}catch(e){}return a}function TsSetVoice(a){var b="";if(TsIsSpeechSynthesisSupported()){try{b=SpeechSynthesis.SetVoice(a)}catch(e){}}else if(ITDIsSecureBrowser()){switch(ITDGetOperatingSystem()){case 1:try{b=TextToSpeech.SetVoice(a)}catch(e){}break;default:try{b=external.TextToSpeech.SetVoice(a)}catch(e){}break}}return b}function TsSetSpeed(a){if(TsIsSpeechSynthesisSupported()){try{SpeechSynthesis.SetSpeed(a)}catch(e){}}else if(ITDIsSecureBrowser()){switch(ITDGetOperatingSystem()){case 1:try{TextToSpeech.SetSpeed(a)}catch(e){}break;default:try{external.TextToSpeech.SetSpeed(a)}catch(e){}break}}}function TsGetDefaultVoice(){var a='';if(TsIsSpeechSynthesisSupported()){try{a=SpeechSynthesis.GetDefaultVoice()}catch(e){}}else if(ITDIsSecureBrowser()){switch(ITDGetOperatingSystem()){case 1:try{a=TextToSpeech.GetDefaultVoice()}catch(e){}break;default:try{a=external.TextToSpeech.GetDefaultVoice()}catch(e){}break}}return a}function TsGetCurrentVoice(){var a='';if(TsIsSpeechSynthesisSupported()){try{a=SpeechSynthesis.GetCurrentVoice()}catch(e){}}else if(ITDIsSecureBrowser()){switch(ITDGetOperatingSystem()){case 1:try{a=TextToSpeech.GetCurrentVoice()}catch(e){}break;default:try{a=external.TextToSpeech.GetCurrentVoice()}catch(e){}break}}return a}function HasClassName(a,b){if(a.className){var c=a.className.split(' ');var d=b.toUpperCase();for(var i=0;i<c.length;i++){if(c[i].toUpperCase()==d){return true}}}return false}function AddClassName(a,b,c){if(a.className){var d=a.className.split(' ');if(c){var e=b.toUpperCase();for(var i=0;i<d.length;i++){if(d[i].toUpperCase()==e){d.splice(i,1);i--}}}d[d.length]=b;a.className=d.join(' ')}else{a.className=b}}function RemoveClassName(a,b){if(a.className){var c=a.className.split(' ');var d=b.toUpperCase();for(var i=0;i<c.length;i++){if(c[i].toUpperCase()==d){c.splice(i,1);i--}}a.className=c.join(' ')}}function ITDChangeImageSize(a,b,c){if(typeof(a.vITDImgSizeData)!="undefined"){if(a.vITDImgSizeData[c].isSmall){b.style.height=a.vITDImgSizeData[c].height;b.style.width=a.vITDImgSizeData[c].width;a.vITDImgSizeData[c].isSmall=false}else{b.style.height=a.vITDImgSizeData[c].smallHeight;b.style.width=a.vITDImgSizeData[c].smallWidth;a.vITDImgSizeData[c].isSmall=true}}}function changeUIFilter(a){if(itdLoadComplete&&!isNavigating){try{var b=elementFrame().document;var c=b.forms[0];var d=b.createElement("input");d.id="UIStyle";d.name="UIStyle";d.type="hidden";d.value=a;c.appendChild(d);navigateTD("refresh")}catch(e){}}}function ApplyTimeFactor(a){if(itdLoadComplete&&!isNavigating){try{var b=elementFrame().document;var c=b.forms[0];var d=b.createElement("input");d.id="TimeFactor";d.name="TimeFactor";d.type="hidden";d.value=a;c.appendChild(d);navigateTD("adjusttime")}catch(e){}}}function AddTime(a){if(itdLoadComplete&&!isNavigating){try{var b=elementFrame();if(b.vTimingEnabled){var c=elementFrame().document;var d=c.forms[0];var f=c.getElementById("TimeToAdd");var g=0;if(f==null){f=c.createElement("input");f.id="TimeToAdd";f.name="TimeToAdd";f.type="hidden";f.value=0;d.appendChild(f)}g=parseInt(f.value);f.value=a+g;b.vMaxTimeAllowed+=a;b.vMaxOverallTimeAllowed+=a}}catch(e){}}}function ResetRemoteItemPoints(){var a=elementFrame();if(typeof(a)!="undefined"&&typeof(a.ResetScore)){a.ResetScore()}}function AwardRemoteItemPoints(a){var b=elementFrame();if(typeof(b)!="undefined"&&typeof(b.Award)){b.Award(a)}}function SetRemoteItemPoints(a){ResetRemoteItemPoints();AwardRemoteItemPoints(a)}function SaveRemoteItemAnswer(a){var b=elementFrame();if(typeof(b)!="undefined"&&typeof(b.Save)!="undefined"){b.Save(a)}}function GetRemoteItemAnswer(){var a=elementFrame();if(typeof(a)!="undefined"&&typeof(a.GetRestartInfo)!="undefined"){return a.GetRestartInfo()}return""}function ITDMobileFramesetDeviceReady(){ITDRemoveEventSimple(document,"deviceready",ITDMobileFramesetDeviceReady);ITDFramesetAction()}function ITDMobileFramesetAction(){ITDAddEventSimple(document,"deviceready",ITDMobileFramesetDeviceReady)}var itdITSUI=null;var itdMobileButtonBarShown=false;var itdMobileInfoPanelShown=false;var itdShownButtons=[];function ITDGetITSUI(){if(itdITSUI==null){if(typeof(window.plugins)!="undefined"&&typeof(window.plugins.itsUI)!="undefined")itdITSUI=window.plugins.itsUI}return itdITSUI}function ITDNoMessageCallback(){}function ITDAlert(){var a=ITDGetITSUI();var i;if(a==null){alert(arguments[0]);if(arguments.length>1){arguments[1]()}}else{itdArguments=[];for(i=0;i<arguments.length;i++)itdArguments.push(arguments[i]);if(itdArguments.length<1)return;if(itdArguments.length<2)itdArguments.push(ITDNoMessageCallback);navigator.notification.alert.apply(this,itdArguments)}}function ITDConfirm(){var a=ITDGetITSUI();if(a==null){var b=2;if(confirm(arguments[0]))b=1;if(arguments.length>1){arguments[1](b)}}else{itdArguments=[];for(i=0;i<arguments.length;i++)itdArguments.push(arguments[i]);if(itdArguments.length<1)return;if(itdArguments.length<2)itdArguments.push(ITDNoMessageCallback);navigator.notification.confirm.apply(this,itdArguments)}}function GetVisibleMobileButtons(){return itdShownButtons}function ShowMobileButtonBar(){var a=ITDGetITSUI();if(a!=null&&!itdMobileButtonBarShown){a.showButtonBar();itdMobileButtonBarShown=true}}function HideMobileButtonBar(){var a=ITDGetITSUI();if(a!=null&&itdMobileButtonBarShown){a.hideButtonBar();itdMobileButtonBarShown=false}}function ShowMobileButtons(){ShowMobileButtonBar();var a=ITDGetITSUI();var i;if(a!=null){itdShownButtons=[];for(i=0;i<arguments.length;i++)itdShownButtons.push(arguments[i]);a.showButtons.apply(this,arguments)}}function SetMobileButtonAutoUnselect(a,b){var c=ITDGetITSUI();if(c!=null)c.updateButton(a,{autounselect:b})}function SetMobileButtonText(a,b){var c=ITDGetITSUI();if(c!=null)c.updateButton(a,{title:b})}function ShowMobileInfoPanel(){var a=ITDGetITSUI();if(a!=null){a.showInfoPanel();itdMobileInfoPanelShown=true}}function HideMobileInfoPanel(){var a=ITDGetITSUI();if(a!=null){a.hideInfoPanel();itdMobileInfoPanelShown=false}}function ShowMobileLabel(a){var b=ITDGetITSUI();if(b!=null)b.showLabel(a)}function HideMobileLabel(a){var b=ITDGetITSUI();if(b!=null)b.hideLabel(a)}function SetMobileLabelText(a,b){var c=ITDGetITSUI();if(c!=null)c.updateLabel(a,{text:b})}function SetMobileLabelHtml(a,b){var c=ITDGetITSUI();if(c!=null)c.updateLabel(a,{html:b})}function ClearMobileQuestionSelection(){var a=ITDGetITSUI();if(a!=null)a.clearQuestionSelection()}function UpdateMobileQuestionSelection(a,b,c){var d=ITDGetITSUI();if(d!=null)d.updateQuestionSelection(a,b,c)}function gotFsForCreate(a){'use strict';if(!itdRecordingFilePath){itdRecordingFilePath=a.root.fullPath+'/'+itdRecordingFileName;console.log('noting record file path as: '+itdRecordingFilePath)}a.root.getFile(itdRecordingFilePath,{create:true},function(){console.log('created wav file');console.log("Initializing audio...");navigator.itdRecordAudio=new Media(itdRecordingFilePath,recording_success,recording_failure);console.log("Initializing audio...OK");console.log("Starting recording...");navigator.itdRecordAudio.startRecord();console.log("Starting recording...OK")},logError)}function gotFsForDelete(a){'use strict';a.root.getFile(itdRecordingFilePath,{create:false},deleteFileEntry,logError)}function deleteFileEntry(b){'use strict';b.remove(function(){console.log("Removal succeeded");navigator.itdRecordAudio=null},function(a){console.log('Error removing file: '+a.code)})}function logError(a){'use strict';console.log('something failed: '+JSON.stringify(a))}function ITDFramesetAction(){if(!pageInit){pageInit=true;itdCurrentLocation="(Loading ITDFramesetAction)";if(typeof(vFailedScripts)!="undefined"&&vFailedScripts.length>0){fatalSystemError("1101","","Unable to load the following scripts: "+vFailedScripts.join(", "),window.location.href,0);return}try{external.ClearClipboard()}catch(e){}try{if(window.opener&&window.opener.location.href.indexOf('starttest.aspx?cmd=home')!=-1)vStartTest=true;if(window.opener&&window.opener.location.href.indexOf('starttest.aspx?cmd=sessionhome')!=-1)vStartTest=true}catch(e){}testTimer=window.setInterval(function(){tick()},400);if(window.screen.height<768){vDefBoxWidth=370;vDefBoxTop='70%'}if(typeof ITDDynamicOnLoad=='function')ITDDynamicOnLoad();ITDAddTestKey(37,null,true,null,null,null,null,"block","[Alt + Left Arrow] is disabled!",null);if(itd.ITDGetBrowser()==2&&parseInt(navigator.appVersion)<=4)document.addEventListener("keypress",ITDKeyHandler,true);else if(itd.ITDGetBrowser()==3&&itd.ITDGetOperatingSystem()==1&&navigator.userAgent.indexOf("1.3")!=-1)document.onkeypress=ITDKeyHandler;else document.onkeydown=ITDKeyHandler;if(itd.location.href.indexOf('Containers=')!=-1)blnWorkShopPreview=true;document.onhelp=function(){event.cancelBubble=true;event.returnValue=false};if(TsIsSpeechSynthesisSupported()){SpeechSynthesis.SetLanguage(vBrowserLanguage)}if(itd.blnBlockEscape==null)itd.blnBlockEscape=true;if(typeof InitializePage=="function")InitializePage();itdCurrentLocation="(Loaded ITDFramesetAction)"}}