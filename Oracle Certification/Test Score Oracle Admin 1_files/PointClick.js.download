function updatePointClickResponse(rIndex){var eFrame=elementFrame();if(eFrame){var vPoints=eFrame.vClickPoints[rIndex];var indicator=vPoints.indicator;var vAnswer='';var vItemData='';while(indicator!=null){if(vAnswer.length!=0)vAnswer+=','+indicator.seq;else vAnswer=indicator.seq;if(vItemData.length!=0)vItemData+=';'+indicator.x+','+indicator.y;else vItemData+=indicator.x+','+indicator.y;indicator=indicator.next}eFrame.document.forms[0].elements['R'+rIndex].value=vAnswer;eFrame.document.forms[0].elements['IDATA'+rIndex].value=vItemData}}function removeClickPoint(rIndex,cpId){var eFrame=elementFrame();if(eFrame){var vPoints=eFrame.vClickPoints[rIndex];var indicator=vPoints.indicator;var previousIndicator=null;while(indicator!=null&&indicator.cpId!=cpId){previousIndicator=indicator;indicator=indicator.next}if(indicator!=null){indicator.imgObject.parentNode.removeChild(indicator.imgObject);vPoints.totalPoints--;if(previousIndicator!=null)previousIndicator.next=indicator.next;else vPoints.indicator=vPoints.indicator.next;indicator.next=null}updatePointClickResponse(rIndex)}}function clearSelections(rIndex){var eFrame=elementFrame();if(eFrame){var vPoints=eFrame.vClickPoints[rIndex];var indicator=vPoints.indicator;while(indicator!=null){indicator.imgObject.parentNode.removeChild(indicator.imgObject);indicator=indicator.next}vPoints.indicator=null;vPoints.totalPoints=0;updatePointClickResponse(rIndex)}}function clearPointClickAnswers(){var eFrame=elementFrame();if(eFrame){var vTotalItems=eFrame.vItemTypeList.length;for(var rIndex=1;rIndex<vTotalItems;rIndex++){if(eFrame.vItemTypeList[rIndex]=='PointClick'){clearSelections(rIndex)}}}}function addClickPoint(rIndex,imgX,imgY,vImg){var eFrame=elementFrame();if(eFrame){var vPoints=eFrame.vClickPoints[rIndex];var indicator=vPoints.indicator;var previousIndicator=null;var hsSequence=getHotSpotSequence(rIndex,imgX,imgY);if(indicator!=null){while(indicator.next!=null&&hsSequence>indicator.seq){previousIndicator=indicator;indicator=indicator.next}if(hsSequence<=indicator.seq){if(previousIndicator)previousIndicator.next={imgObject:vImg,x:imgX,y:imgY,cpId:eFrame.vCurrentCpId,seq:hsSequence,next:indicator};else vPoints.indicator={imgObject:vImg,x:imgX,y:imgY,cpId:eFrame.vCurrentCpId,seq:hsSequence,next:indicator}}else{indicator.next={imgObject:vImg,x:imgX,y:imgY,cpId:eFrame.vCurrentCpId,seq:hsSequence,next:indicator.next}}}else vPoints.indicator={imgObject:vImg,x:imgX,y:imgY,cpId:eFrame.vCurrentCpId,seq:hsSequence,next:null};vPoints.totalPoints++;updatePointClickResponse(rIndex)}}function isPointInPolygon(polyPoints,x,y){var vIsInPolygon=false;var vTotalPoints=polyPoints.length;var newX,newY,oldX,oldY;var x1,y1,x2,y2;if(vTotalPoints<3)return false;oldX=polyPoints[vTotalPoints-1].x;oldY=polyPoints[vTotalPoints-1].y;for(var vIndex=0;vIndex<vTotalPoints;vIndex++){newX=polyPoints[vIndex].x;newY=polyPoints[vIndex].y;if(newX>oldX){x1=oldX;x2=newX;y1=oldY;y2=newY}else{x1=newX;x2=oldX;y1=newY;y2=oldY}if(((newX<x)==(x<=oldX))&&(((y-y1)*(x2-x1))<(y2-y1)*(x-x1)))vIsInPolygon=!vIsInPolygon;oldX=newX;oldY=newY}return vIsInPolygon}function isPointInRegion(region,x,y){switch(region.type){case'C':if((Math.pow((x-region.x),2)+Math.pow((y-region.y),2))<=Math.pow(region.rad,2))return true;break;case'E':if((Math.pow((region.vRad*(x-region.x)),2)+Math.pow((region.hRad*(y-region.y)),2))<=Math.pow((region.hRad*region.vRad),2))return true;break;case'R':if((x>=region.upperLeft.x)&&(x<=region.lowerRight.x)&&(y>=region.upperLeft.y)&&(y<=region.lowerRight.y))return true;break;case'P':return isPointInPolygon(region.points,x,y);break}return false}function getHotSpotSequence(rIndex,x,y){var eFrame=elementFrame();if(eFrame){var vTotalHotspots=eFrame.vHotSpots[rIndex].length;if(vTotalHotspots>0){for(var vIndex=0;vIndex<vTotalHotspots;vIndex++){if(isPointInRegion(eFrame.vHotSpots[rIndex][vIndex],x,y))return eFrame.vHotSpots[rIndex][vIndex].seq}}}return 0}function isPointInClickRegion(rIndex,x,y){var eFrame=elementFrame();if(eFrame){var vTotalClickRegions=eFrame.vClickRegions[rIndex].length;if(vTotalClickRegions>0){for(var vIndex=0;vIndex<vTotalClickRegions;vIndex++){if(isPointInRegion(eFrame.vClickRegions[rIndex][vIndex],x,y))return true}}else return true}return false}function setClickPoint(rIndex,x,y,srcElm){var eFrame=elementFrame();if(eFrame){var vPoints=eFrame.vClickPoints[rIndex];var vImg=null;var sngTop=y;var sngLeft=x;if(eFrame.vItemMaximumAllowed[rIndex]==1){if(vPoints.totalPoints>=1)clearSelections(rIndex)}else{if(vPoints.totalPoints>=eFrame.vItemMaximumAllowed[rIndex]){itd.ITDAlert(itd.PTCLMaxReached.replace("%max%",eFrame.vItemMaximumAllowed[rIndex]));return}}var imgPos=getPosition(srcElm);sngLeft=imgPos.x+x;sngTop=imgPos.y+y;eFrame.vCurrentCpId++;if(typeof srcElm.insertAdjacentHTML!="undefined"){var spanElm=srcElm;while(spanElm&&spanElm.tagName.toUpperCase()!='SPAN'){spanElm=spanElm.parentNode}var onClickText="";if(!eFrame.vPageReadOnly)onClickText=" ONCLICK='itd.removeClickPoint("+rIndex+", "+eFrame.vCurrentCpId+"); return itd.ITDStopEvent(event, window);'";spanElm.insertAdjacentHTML("beforeEnd","<IMG ID='CP"+eFrame.vCurrentCpId+"' SRC='"+eFrame.document.getElementById("clickspotindicator").src+"' STYLE='position:absolute; cursor:hand; cursor:pointer; z-index:100; left:"+(sngLeft-eFrame.itdPCAdjustWidth)+"px; top:"+(sngTop-eFrame.itdPCAdjustHeight)+"px;'"+onClickText+">");vImg=eFrame.document.getElementById("CP"+eFrame.vCurrentCpId)}else{vImg=eFrame.document.createElement("IMG");vImg.id="CP"+eFrame.vCurrentCpId;vImg.src=eFrame.document.getElementById("clickspotindicator").src;if(!eFrame.vPageReadOnly)vImg.setAttribute("onClick","itd.removeClickPoint("+rIndex+", "+eFrame.vCurrentCpId+"); return itd.ITDStopEvent(event, window);",0);vImg.style.cssText="position:absolute; cursor:hand; cursor:pointer; z-index:100; left:"+(sngLeft-eFrame.itdPCAdjustWidth)+"px; top:"+(sngTop-eFrame.itdPCAdjustHeight)+"px;";eFrame.document.body.appendChild(vImg)}addClickPoint(rIndex,x,y,vImg)}}function onHotspotImageClick(evt,rIndex){if(itd.isNavigating||!itd.itdLoadComplete)return false;var eFrame=elementFrame();if(eFrame){var x;var y;var srcElm;if(!evt)evt=eFrame.event||{};srcElm=getEventTarget(evt);if(evt.offsetX){x=evt.offsetX;y=evt.offsetY}else{var imgPos=getPosition(srcElm);x=evt.layerX-imgPos.x;y=evt.layerY-imgPos.y}if(isPointInClickRegion(rIndex,x,y))setClickPoint(rIndex,x,y,srcElm);return ITDStopEvent(evt,eFrame)}return false}function initializePointClickItems(){var eFrame=elementFrame();if(eFrame){var vTotalItems=eFrame.vItemTypeList.length;var vIndex=0;for(var rIndex=1;rIndex<vTotalItems;rIndex++){if(eFrame.vItemTypeList[rIndex]=='PointClick'){var vPoints=eFrame.vCurrentPoints[rIndex];var vTotalPoints=vPoints.length;var vSpanElm=eFrame.document.getElementById("hotspotarea"+rIndex);var vHotspotImg=null;var vTotalChildren=vSpanElm.childNodes.length;if(vTotalChildren>0){for(vIndex=0;vIndex<vTotalChildren;vIndex++){if(vSpanElm.childNodes[vIndex].tagName=='IMG'){vHotspotImg=vSpanElm.childNodes[vIndex];break}}}if(vTotalPoints>0&&vHotspotImg!=null){for(vIndex=0;vIndex<vTotalPoints;vIndex++)setClickPoint(rIndex,vPoints[vIndex].x,vPoints[vIndex].y,vHotspotImg)}}}}}