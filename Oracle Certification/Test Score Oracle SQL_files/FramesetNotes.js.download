function itdNTEnableEdit(){return typeof(itd.vEnableNoteEdit)!="undefined"&&itd.vEnableNoteEdit};function itdNTEnablePersist(){return typeof(itd.vEnableNotePersist)!="undefined"&&itd.vEnableNotePersist}function itdNTEnableCollapse(){return typeof(itd.vEnableNoteCollapse)=="undefined"||itd.vEnableNoteCollapse}function itdNTStartCollapsed(){return typeof(itd.vStartNoteCollapsed)=="undefined"||itd.vStartNoteCollapsed}function itdNTCompareRange(a,b){var p=null;if(a.compareEndPoints){p={method:"compareEndPoints",StartToStart:"StartToStart",StartToEnd:"StartToEnd",EndToEnd:"EndToEnd",EndToStart:"EndToStart"}}else if(a.compareBoundaryPoints){p={method:"compareBoundaryPoints",StartToStart:0,StartToEnd:1,EndToEnd:2,EndToStart:3}}var c=null;if(p){c={StartToStart:b[p.method](p.StartToStart,a),StartToEnd:b[p.method](p.StartToEnd,a),EndToEnd:b[p.method](p.EndToEnd,a),EndToStart:b[p.method](p.EndToStart,a)}}return c}function itdNTHtmlEncode(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function itdNTDoInsert(a){if(typeof(itd.DisplayInsertNoteDialog)!="undefined"){itd.DisplayInsertNoteDialog(a)}else{var b=prompt(itd.ANEnterNote,"");if(b!=null&&b.length>0)itdNTInsertNote(a,b)}}function itdNTDoEdit(a){if(typeof(itd.DisplayEditNoteDialog)!="undefined"){itd.DisplayEditNoteDialog(a)}else{var b=prompt(itd.ANEditNote,a.noteText);if(b!=null&&b!=a.noteText)itdNTModifyNote(a,b)}}function itdNTDoRemove(a){if(typeof(itd.DisplayRemoveNoteDialog)!="undefined"){itd.DisplayRemoveNoteDialog(a)}else{if(confirm('Remove note?'))itdNTModifyNote(a,"")}}function itdNTGetNote(a){var b='';if(a.className=='itdnote'){if(typeof(a.innerText)!="undefined")b=a.innerText;else if(typeof(a.textContent)!="undefined")b=a.textContent;else b=a.innerHTML;if(b.length>=2)b=b.substr(1,b.length-2)}else if(a.className=='itdimgnote')b=a.title;return b}function itdNTModifyNote(a,b){if(b.length==0){a.noteElm.parentNode.removeChild(a.noteElm);itd.itdANSetChanged(a.window)}else if(b!=a.noteText){if(a.noteElm.className=='itdnote')a.noteElm.innerHTML="["+itdNTHtmlEncode(b)+"]";else if(a.noteElm.className=='itdimgnote')a.noteElm.title=b;itd.itdANSetChanged(a.window)}}function itdNTEdit(e,a){e=(e)?e:((a.window.event)?a.window.event:null);var b=((e.target)?e.target:((e.srcElement)?e.srcElement:this));if(b.nodeType==3)b=b.parentNode;var c=a.window.itdNTTarget;if(c.length>0){b=a.document.getElementById(c);a.window.itdNTRemoveTarget(e)}var d=b.className;if(d=='itdnote'||d=='itdimgnote'){a.noteText=itdNTGetNote(b);a.noteElm=b;if(itdNTEnableEdit())itdNTDoEdit(a);else itdNTDoRemove(a)}return itd.ITDStopEvent(e,a.window)}function itdNTExpandCollapse(e,a){e=(e)?e:((a.window.event)?a.window.event:null);var b=((e.target)?e.target:((e.srcElement)?e.srcElement:this));if(b.nodeType==3)b=b.parentNode;var c=a.window.itdNTTarget;if(c.length>0){b=a.document.getElementById(c);a.window.itdNTRemoveTarget(e)}var d=b.className;var f=null;var g=itdNTGetNote(b);if(d=='itdnote'){f=a.document.createElement("img");f.title=g;f.src='images/notes/notemarker.gif';f.className='itdimgnote';f.setAttribute("draggable","false");f.setAttribute("unselectable","on");f.setAttribute("ondragstart","return false;")}else if(d=='itdimgnote'){f=a.document.createElement("span");f.innerHTML="["+itdNTHtmlEncode(g)+"]";f.className="itdnote"}if(f!=null){f.id=b.id;itdNTApplyEvents(a,f);b.parentNode.replaceChild(f,b);itd.itdANSetChanged(a.window)}return itd.ITDStopEvent(e,a.window)}function itdNTApplyEvents(a,b){if(b!=null){if(itdNTEnableCollapse()){itd.ITDAddEventSimple(b,'click',a.window.itdNTLocalExpandCollapse);itd.ITDAddEventSimple(b,'contextmenu',a.window.itdNTLocalEdit)}else itd.ITDAddEventSimple(b,'click',a.window.itdNTLocalEdit);if(navigator.userAgent.indexOf('Mac')!=-1){itd.ITDAddEventSimple(b,'mouseover',a.window.itdNTSetTarget);itd.ITDAddEventSimple(b,'mouseout',a.window.itdNTRemoveTarget)}}}function itdNTInsertNote(a,b){if(b&&b.length>0){var c="";var d="";var e=null;var f=null;if(itdNTEnableCollapse())d=" oncontextmenu='itdNTLocalEdit(event);'";else d=" onclick='itdNTLocalEdit(event);'";if(navigator.userAgent.indexOf('Mac')!=-1)d+=" onmouseover='itdNTSetTarget(event);' onmouseout='itdNTRemoveTarget(event);'";if(!itdNTStartCollapsed()){if(document.createRange){var g=itdNTCreateNoteElement("nt",b,a);a.noteRange.insertNode(g)}else{a.noteCount++;if(itdNTEnableCollapse())c=" onclick='itdNTLocalExpandCollapse(event);'";a.noteRange.pasteHTML("<span id='nt-"+a.noteCount+"' class='itdnote'"+c+d+">["+itdNTHtmlEncode(b)+"]</span>")}}else{if(document.createRange){var h=itdNTCreateNoteElement("ni",b,a);a.noteRange.insertNode(h)}else{a.noteCount++;b=itdNTHtmlEncode(b);b=b.replace(/"/g,"&quot;");if(itdNTEnableCollapse())c=' onclick="itdNTLocalExpandCollapse(event);"';a.noteRange.pasteHTML('<img id="nt-'+a.noteCount+'" src="images/notes/notemarker.gif" class="itdimgnote" title="'+b+'"'+c+d+' draggable="false" ondragstart="return false;" unselectable="on">')}}e=a.document.getElementById("nt-"+a.noteCount);f=e;while(f!=null&&!$(f).hasClass("itdhilite"))f=f.parentElement;if(f!=null)$(e).insertAfter($(f));itd.itdANSetChanged(a.window)}}function itdNTInsert(e,a){e=(e)?e:((a.window.event)?a.window.event:null);var b=((e.target)?e.target:((e.srcElement)?e.srcElement:this));if(b.nodeType==3)b=b.parentNode;if(typeof(b.className)!="undefined"){if(b.className=="itdhilite")return;else if(b.className=="itdnote"||b.className=="itdimgnote")return}var c=itd.itdGetSelectionObject(a.window);var d=itd.itdGetRangeSelectionObject(c,a.document);if(d){var f=null;if(window.getSelection)f=d.commonAncestorContainer;else f=d.parentElement();if(typeof(f.className)!="undefined"&&f.className=="itdhilite")return itd.ITDStopEvent(e,a.window);var g=itd.itdNTCompareRange(d,d);if(g.StartToEnd==0){a.noteRange=d;itdNTDoInsert(a)}else if(typeof(a.window.itdHLHighlightingActive)=="undefined"||!a.window.itdHLHighlightingActive){if(window.getSelection)try{c.collapseToStart()}catch(e){}else a.document.selection.empty()}}return itd.ITDStopEvent(e,a.window)}function itdNTGetNodeCount(a,b){var c=0;var d=0;var i=0;if(typeof(a.tagName)!="undefined"){var e=b.document.body.getElementsByTagName(a.tagName);for(i=0;i<e.length;i++){d++;if(e[i]==a){c=d;break}}}return c}function itdNTGetTextCount(a,b,c,d){if(!c){c=b.document.body}if(!d){var e=a.nodeValue.substr(a.nodeValue.length-1);d={lastChar:e,lastCount:0,foundNode:false}}if(d.lastChar.length==0)return d;else if(d.foundNode)return termCount;if(c.nodeType==3&&c.parentNode.className!='itdnote'){var f=c.nodeValue;var g=f.indexOf(d.lastChar);if(g!=-1&&c==a){d.lastCount+=(f.split(d.lastChar).length-1);d.foundNode=true}else d.lastCount+=(f.split(d.lastChar).length-1)}else if(c.nodeType!=3&&typeof(c.tagName)!='undefined'&&c.tagName.toUpperCase()!='INPUT'&&c.tagName.toUpperCase()!='TEXTAREA'&&c.tagName.toUpperCase()!='IFRAME'){if(c.hasChildNodes){var h;for(h=0;h<c.childNodes.length;h++){if(d.foundNode)break;itdNTGetTextCount(a,b,c.childNodes[h],d)}}}return d}function itdNTCreateNoteElement(a,b,c){var d=null;if(a=="ni"){c.noteCount++;d=c.document.createElement("img");d.title=b;d.src='images/notes/notemarker.gif';d.className='itdimgnote';d.id='nt-'+c.noteCount;d.setAttribute("draggable","false");d.setAttribute("unselectable","on");d.setAttribute("ondragstart","return false;")}else if(a=="nt"){c.noteCount++;d=c.document.createElement("span");d.innerHTML="["+itdNTHtmlEncode(b)+"]";d.className="itdnote";d.id='nt-'+c.noteCount}if(d!=null)itdNTApplyEvents(c,d);return d}function itdNTAddNoteByTextRef(a,b,c,d){if(!c){c=b.document.body}if(!d){d={lastCount:0,foundNode:false}}if(a.lc.length==0)return;else if(d.foundNode)return;if(c.nodeType==3&&c.parentNode.className!='itdnote'){var e=c.nodeValue;var f=e.indexOf(a.lc);if(f!=-1){var g=e.split(a.lc);var h=(g.length-1);if((d.lastCount+h)>=a.count){var j=(a.count-d.lastCount);var k=0;var i=0;for(i=0;i<j;i++){k+=g[i].length+1}var l=b.document.createTextNode(e.substr(0,k));var m=null;if(k<e.length)m=b.document.createTextNode(e.substr(k));var n=c.parentNode;var o=itdNTCreateNoteElement(a.type,a.txt,b);n.insertBefore(l,c);n.insertBefore(o,c);if(m)n.insertBefore(m,c);n.removeChild(c);d.foundNode=true}else d.lastCount+=h}}else if(c.nodeType!=3&&typeof(c.tagName)!='undefined'&&c.tagName.toUpperCase()!='INPUT'&&c.tagName.toUpperCase()!='TEXTAREA'&&c.tagName.toUpperCase()!='IFRAME'){if(c.hasChildNodes){var p;for(p=0;p<c.childNodes.length;p++){if(d.foundNode)break;itdNTAddNoteByTextRef(a,b,c.childNodes[p],d)}}}}function itdNTAddNoteByElementRef(a,b,c){var d=0;var i=0;var e=null;if(c!=null)e=c.getElementsByTagName(a.tag);else e=b.document.body.getElementsByTagName(a.tag);for(i=0;i<e.length;i++){d++;if(a.count==d){var f=itdNTCreateNoteElement(a.type,a.txt,b);if(a.ref=="p"){if(e[i].childNodes.length>0)e[i].insertBefore(f,e[i].childNodes[0]);else e[i].appendChild(f)}else{var g=e[i].parentNode;var h=e[i].nextSibling;if(h)g.insertBefore(f,h);else g.appendChild(f)}break}}}function itdNTAddNote(a,b,c){if(a.ref=="t")itdNTAddNoteByTextRef(a,b,c);else itdNTAddNoteByElementRef(a,b,c)}