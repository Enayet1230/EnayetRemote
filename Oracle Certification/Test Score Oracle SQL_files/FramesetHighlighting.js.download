var itdHLStartNodeFound=false;var itdHLEndNodeFound=false;var itdHLEndFoundBeforeStart=false;var itdHLRanges=null;var itdHLOverlaps=null;var itdHLRangeCount=0;var itdHLOverlapCount=0;function itdHLCompareEnd(a,b){var p=null;if(a.compareEndPoints){p={method:"compareEndPoints",EndToEnd:"EndToEnd"}}else if(a.compareBoundaryPoints){p={method:"compareBoundaryPoints",EndToEnd:2}}var c=1;if(p)c=b[p.method](p.EndToEnd,a);return c}function itdHLCompareStart(a,b){var p=null;if(a.compareEndPoints){p={method:"compareEndPoints",StartToStart:"StartToStart"}}else if(a.compareBoundaryPoints){p={method:"compareBoundaryPoints",StartToStart:0}}var c=-1;if(p)c=b[p.method](p.StartToStart,a);return c}function itdHLCompareRange(a,b){var p=null;if(a.compareEndPoints){p={method:"compareEndPoints",StartToStart:"StartToStart",StartToEnd:"StartToEnd",EndToEnd:"EndToEnd",EndToStart:"EndToStart"}}else if(a.compareBoundaryPoints){p={method:"compareBoundaryPoints",StartToStart:0,StartToEnd:1,EndToEnd:2,EndToStart:3}}var c=null;if(p){c={StartToStart:b[p.method](p.StartToStart,a),StartToEnd:b[p.method](p.StartToEnd,a),EndToEnd:b[p.method](p.EndToEnd,a),EndToStart:b[p.method](p.EndToStart,a)}}return c}function itdFindHLIndex(a,b){var i;var j;var c=-1;var d=-1;var e=-1;for(i=0;i<b.hiliteArray.length;i++){if(b.hiliteArray[i].id==a)return i}return-1}function itdSortHighlights(a,b){if(a.index==b.index){var c=parseInt(a.id.substr(3));var d=parseInt(b.id.substr(3));return c-d}return a.index-b.index}function itdHLChangeIndex(a,b){var i;var c=false;var d=b.hiliteIndexCount;for(i=0;i<b.hiliteArray.length;i++){if(b.hiliteArray[i].index==a){c=true;b.hiliteArray[i].index=d}else if(c)break}if(c)b.hiliteArray.sort(itdSortHighlights)}function itdHLFindRange(a,b){var i;var j;var c=-1;var d=-1;var e=-1;i=itdFindHLIndex(a,b);if(i>=0){d=i;e=i;c=b.hiliteArray[i].index;for(j=d;j>=0;j--){if(b.hiliteArray[j].index!=c)break;d=j}for(j=e;j<b.hiliteArray.length;j++){if(b.hiliteArray[j].index!=c)break;e=j}}return{start:d,end:e}}function itdHLRemove(a,b){var c=itdHLFindRange(a.id,b);var i;var j;if(c.start>=0){for(i=c.start;i<=c.end;i++){var d=b.document.getElementById(b.hiliteArray[i].id);if(d!=null){var e=d.parentNode;if(d.childNodes.length>0){if(itdIsIE||typeof(e.normalize)=="undefined"||d.childNodes.length!=1){var f=null;var g=d.previousSibling;var h="";while(g&&g.parentNode==e&&g.nodeType==3){h=g.nodeValue+h;e.removeChild(g);g=g.previousSibling}for(j=0;j<d.childNodes.length;j++)h+=d.childNodes[j].nodeValue;var k=d.nextSibling;while(k&&k.parentNode==e&&k.nodeType==3){h+=k.nodeValue;e.removeChild(k);k=k.nextSibling}f=b.document.createTextNode(h);e.replaceChild(f,d)}else{var l=d.childNodes[0].cloneNode(true);e.replaceChild(l,d);e.normalize()}}}}b.hiliteArray.splice(c.start,(c.end-c.start+1));if(b.hiliteArray.length==0){b.resetData()}}}function itdHLCreateRange(a,b){if(document.createRange){newRange=a.document.createRange();if(itdANIsWebKit&&itdANWKVersion>=522)newRange.selectNodeContents(b);else newRange.selectNode(b)}else{newRange=a.document.body.createTextRange();newRange.moveToElementText(b)}return newRange}function itdHLCreateTextRange(a,b){var c=null;if(document.createRange){c=a.document.createRange();if(document.all&&window.atob){c.selectNode(b)}if(itdANIsWebKit&&itdANWKVersion>=522)c.selectNodeContents(b);else c.selectNode(b)}else{c=a.document.body.createTextRange();c.moveToElementText(b.parentNode);var d=0;var e=b;while(e.previousSibling!=null){e=e.previousSibling;if(typeof(e.innerText)!="undefined")d+=e.innerText.length;else if(e.nodeType==3)d+=e.nodeValue.length}if(d>0)c.moveStart("character",d);c.findText(b.nodeValue);if(c.text.length>b.nodeValue.length)c.moveEnd("character",-(c.text.length-b.nodeValue.length-1));if(c.text.length>b.nodeValue.length)c.moveStart("character",(c.text.length-b.nodeValue.length))}return c}function itdHLCompareTextRanges(a,b,c){if(a){if(a.nodeType==3&&a.nodeValue.trim().length>0){var d=null;var e=a;var f=true;if(e.parentNode.className=='itdnote'||itdHLIsHiddenElement(e.parentNode))return 0;d=itdHLCreateTextRange(c,e);if(d){var g=itdHLCompareRange(b,d);if((g.StartToStart<0&&g.EndToStart<0)||(g.StartToEnd>0&&g.EndToEnd>0))return 0;if(e.parentNode.className!='itdhilite'){var h=0;var k=1;var l=false;var m=false;var n=0;var o=null;var p=0;var q=null;var r=0;if(typeof(d.text)!="undefined"){n=d.text.length;k=n-1}if((g.StartToEnd<=0||g.StartToStart<=0)&&g.EndToEnd==1){f=false;m=true;if(document.createRange){q=d.endContainer;r=d.endOffset;p=d.startOffset;while(r>p){r--;d.setEnd(q,r);g.EndToEnd=itdHLCompareEnd(b,d);if(g.EndToEnd<=0)break}if(r<=p)d=null}else{while(d.text.length>0){var s=d.text;d.moveEnd("character",-1);if(s!=d.text)k--;g.EndToEnd=itdHLCompareEnd(b,d);if(g.EndToEnd<=0)break}if(d.text.length==0)d=null}}if(k<=h&&(m||n==0))return 0;if(d&&(g.EndToStart>=0||g.EndToEnd>=0)&&g.StartToStart==-1){f=false;l=true;if(document.createRange){o=d.startContainer;p=d.startOffset;r=d.endOffset;while(p<r){p++;d.setStart(o,p);g.StartToStart=itdHLCompareStart(b,d);if(g.StartToStart>=0)break}if(p>=r)d=null}else{var t=false;while(d.text.length>0){var u=d.text;d.moveStart("character",1);if(u!=d.text){h++;t=true}var v=g.StartToStart;g.StartToStart=itdHLCompareStart(b,d);if(g.StartToStart>=0){if(v==-1&&g.StartToStart==1){if(t)h--;d.moveStart("character",-1)}break}}if(d.text.length==0)d=null}}if(g.StartToStart<0||g.EndToEnd>0)d=null;if(d){g=itdHLCompareRange(d,d);if(g.StartToEnd!=0&&g.EndToStart!=0){h=(l?h:-1);k=(m?k:-1);itdHLRanges[itdHLRangeCount]={range:d,node:e,fullNode:f,startOffset:h,endOffset:k};itdHLRangeCount++}}}else if((g.StartToStart>=0&&g.StartToEnd<=0)||(g.EndToStart>=0&&g.EndToEnd<=0)){var w=itdFindHLIndex(e.parentNode.id,c);if(w>=0){var x=c.hiliteArray[w].index;var j=0;var y=false;for(j=0;j<itdHLOverlapCount;j++){if(x==itdHLOverlaps[j]){y=true;break}}if(!y){itdHLOverlaps[itdHLOverlapCount]=x;itdHLOverlapCount++}}}}}else if(a.nodeType!=3&&typeof(a.tagName)!='undefined'&&a.tagName.toUpperCase()!='INPUT'&&a.tagName.toUpperCase()!='TEXTAREA'&&a.tagName.toUpperCase()!='IFRAME'){if(a.hasChildNodes()){for(var i=0;i<a.childNodes.length;i++){itdHLCompareTextRanges(a.childNodes[i],b,c)}}}}}function itdHLGetStyle(a,b){var y=null;if(typeof(a.currentStyle)!="undefined")y=a.currentStyle[b];else if(typeof(window.getComputedStyle)!="undefined")y=document.defaultView.getComputedStyle(a,null).getPropertyValue(b);else if(typeof(a.style)!="undefined")y=a.style[b];return y}function itdHLIsHiddenElement(a){var y=false;while(!y&&a&&(typeof(a.tagName)=="undefined"||a.tagName!='BODY')){if(itdHLGetStyle(a,"display")=="none"||itdHLGetStyle(a,"visibilty")=="hidden"){y=true;break}a=a.parentNode}return y}function itdHLUseStartEndNodes(a,b,c,d,e,f){var i;var g=false;var h=false;var k=true;if(a!=null&&!itdHLEndNodeFound){if(!itdHLStartNodeFound&&a==b){itdHLStartNodeFound=true;g=true}if(itdHLEndFoundBeforeStart&&itdHLStartNodeFound&&a.parentNode==d){itdHLEndNodeFound=true;itdHLEndFoundBeforeStart=false;h=true}else if(a==d){if(!itdHLStartNodeFound){itdHLEndFoundBeforeStart=true}else{itdHLEndNodeFound=true;itdHLEndFoundBeforeStart=false;h=true}}if(itdHLStartNodeFound&&a.nodeType==3&&a.nodeValue.trim().length>0){var l=null;if(a.parentNode.className=='itdnote'||itdHLIsHiddenElement(a.parentNode))return;if(a.parentNode.className!='itdhilite'){l=itdHLCreateTextRange(f,a)}else{var m=itdFindHLIndex(a.parentNode.id,f);if(m>=0){var n=f.hiliteArray[m].index;var j=0;var o=false;for(j=0;j<itdHLOverlapCount;j++){if(n==itdHLOverlaps[j]){o=true;break}}if(!o){itdHLOverlaps[itdHLOverlapCount]=n;itdHLOverlapCount++}}}if(g&&h){if(l){k=false;l.setStart(a,c);l.setEnd(a,e)}}else if(g){if(l)l.setStart(a,c);if(c>0)k=false}else if(h){if(e==0)l=null;else{if(l){l.setStart(a,0);l.setEnd(a,e)}k=false}}if(l){var p=itdHLCompareRange(l,l);if(p.StartToEnd!=0&&p.EndToStart!=0){itdHLRanges[itdHLRangeCount]={range:l,node:a,fullNode:k,startOffset:l.startOffset,endOffset:l.endOffset};itdHLRangeCount++}}}else if(a.nodeType!=3&&typeof(a.tagName)!='undefined'&&a.tagName.toUpperCase()!='INPUT'&&a.tagName.toUpperCase()!='TEXTAREA'&&a.tagName.toUpperCase()!='IFRAME'){if(!itdHLEndNodeFound&&a.hasChildNodes()){for(i=0;i<a.childNodes.length;i++){itdHLUseStartEndNodes(a.childNodes[i],b,c,d,e,f)}}}}}function itdCleanHtml(a){var b=a.indexOf("<");var c=0;while(b>=0){c=a.indexOf(">",b+1);if(c>b)a=a.substr(0,b)+a.substr(c+1);b=a.indexOf("<")}return a}function itdHighlightTextNodes(a,b){var c=null;var d=null;var f=null;var g=0;var h=0;var j=null;var k=null;itdHLRanges=new Array();itdHLRangeCount=0;itdHLOverlaps=new Array();itdHLOverlapCount=0;itdHLStartNodeFound=false;itdHLEndNodeFound=false;itdHLEndFoundBeforeStart=false;if(window.getSelection){f=a.commonAncestorContainer;c=a.startContainer;d=a.endContainer;g=a.startOffset;h=a.endOffset;while(d.nodeType!=3){if(d.childNodes.length>h){var l=d.childNodes[h];if(l.nodeType==3)a.setEnd(l,l.nodeValue.length);else a.setEnd(l,l.textContent.length);d=a.endContainer;h=a.endOffset}else break}}else{f=a.parentElement();c=null;d=null;g=0;h=0;j=itdHLCreateRange(b,f);k=itdHLCompareRange(a,j);while(f.parentNode!=null&&(k.StartToStart>0||k.EndToEnd<0)){f=f.parentNode;j=itdHLCreateRange(b,f);k=itdHLCompareRange(a,j)}}if(itdHLUseBestMethod)itdHLCompareTextRanges(f,a,b);else itdHLUseStartEndNodes(f,c,g,d,h,b);if(itdHLRangeCount>0){var i;b.hiliteIndexCount+=1;itd.itdANSetChanged(b.window);for(i=(itdHLRangeCount-1);i>=0;i--){var m='hi-'+(b.hiCount+1).toString();var n='';var o='';var p=null;if(!itdIsFireFox&&itdIsGecko){var q=itdHLRanges[i].node.nodeValue;var r=itdHLRanges[i].startOffset;var s=itdHLRanges[i].endOffset;if(r>=s)s=q.length;if(itdHLRanges[i].fullNode){r=0;s=q.length}var t=s-r;if(t>0){var u=null;var v=null;var w=null;var x=null;if(r>0)u=b.document.createTextNode(q.substr(0,r));v=q.substr(r,t);if((q.length-r-t)>0)w=b.document.createTextNode(q.substr(r+t));x=b.document.createTextNode(v);var y=itdHLRanges[i].node.parentNode;p=b.document.createElement("span");p.id=m;p.className='itdhilite';p.setAttribute('onclick','itd.itdHLRemove(this, itdHLPageData);');p.appendChild(x);if(u!=null)y.insertBefore(u,itdHLRanges[i].node);y.insertBefore(p,itdHLRanges[i].node);if(w!=null)y.insertBefore(w,itdHLRanges[i].node);y.removeChild(itdHLRanges[i].node);p=b.document.getElementById(m)}}else if(itdHLRanges[i].range.surroundContents){p=b.document.createElement("span");p.id=m;p.className='itdhilite';p.setAttribute('onclick','itd.itdHLRemove(this, itdHLPageData);');itdHLRanges[i].range.surroundContents(p);p=b.document.getElementById(m)}else{if(itdIsIE&&!itdHLRanges[i].fullNode){if(itdHLRanges[i].range.text.length>(itdHLRanges[i].endOffset-itdHLRanges[i].startOffset+1)){itdHLRanges[i].endOffset+=itdHLRanges[i].range.text.length-(itdHLRanges[i].endOffset-itdHLRanges[i].startOffset+1)}if(itdHLRanges[i].endOffset>=0){try{itdHLRanges[i].node.splitText(itdHLRanges[i].endOffset+1)}catch(e){}}if(itdHLRanges[i].startOffset>=0){try{itdHLRanges[i].node=itdHLRanges[i].node.splitText(itdHLRanges[i].startOffset)}catch(e){}}itdHLRanges[i].fullNode=true}if(itdHLRanges[i].fullNode){try{var z=itdHLRanges[i].node;var A=z.parentNode;var B=z.cloneNode(true);p=b.document.createElement("span");p.id=m;p.className='itdhilite';p.onclick=b.window.itdHLRemoveLocal;p.appendChild(B);A.replaceChild(p,z)}catch(e){}}}if(p){n=p.childNodes[0].nodeValue;b.hiliteArray[b.hiliteArray.length]={id:m,index:b.hiliteIndexCount,text:n};b.hiCount++}}if(itdHLOverlapCount>0){for(i=0;i<itdHLOverlapCount;i++){itdHLChangeIndex(itdHLOverlaps[i],b)}}}}function itdHLGetTextCount(a,b,c,d,e){if(!d){d=c.document.body}if(!e){var f='';if(a.length>0)f=a.substr(0,1);e={firstChar:f,firstCount:0,len:0,foundNode:false}}if(a.length==0)return e;else if(e.foundNode)return termCount;if(d.nodeType==3&&d.parentNode.className!='itdnote'){var g=d.nodeValue;var h=g.indexOf(e.firstChar);if(h!=-1&&d.parentNode.className=='itdhilite'&&d.parentNode.id==b){e.firstCount++;e.foundNode=true;e.len=g.length}else e.firstCount+=(g.split(e.firstChar).length-1)}else if(d.nodeType!=3&&typeof(d.tagName)!='undefined'&&d.tagName.toUpperCase()!='INPUT'&&d.tagName.toUpperCase()!='TEXTAREA'&&d.tagName.toUpperCase()!='IFRAME'){if(d.hasChildNodes){var i;for(i=0;i<d.childNodes.length;i++){if(e.foundNode)break;itdHLGetTextCount(a,b,c,d.childNodes[i],e)}}}return e}function itdHLHighlightTextNode(a,b,c,d){if(!c){c=b.document.body}if(!d){d={firstCount:0,foundNode:false}}if(a.fc.length==0)return;else if(d.foundNode)return;if(c.nodeType==3&&c.parentNode.className!='itdnote'){var e=c.nodeValue;var f=e.indexOf(a.fc);if(f!=-1){var g=e.split(a.fc);var h=(g.length-1);if((d.firstCount+h)>=a.count){var j=(a.count-d.firstCount);var k=0;var l=0;var i=0;for(i=0;i<j;i++){k+=g[i].length+l;l=1}var m=null;var n=null;var o=null;var p=null;if(k>0)m=b.document.createTextNode(e.substr(0,k));n=e.substr(k,a.len);if((e.length-k-a.len)>0)o=b.document.createTextNode(e.substr(k+a.len));p=b.document.createTextNode(n);var q=c.parentNode;var r=b.document.createElement("span");var s='hi-'+(b.hiCount+1).toString();r.id=s;r.className='itdhilite';r.onclick=b.window.itdHLRemoveLocal;r.appendChild(p);if(m!=null)q.insertBefore(m,c);q.insertBefore(r,c);if(o!=null)q.insertBefore(o,c);q.removeChild(c);originalText=r.childNodes[0].nodeValue;b.hiliteArray[b.hiliteArray.length]={id:s,index:a.idx,text:originalText};b.hiCount++;d.foundNode=true}else d.firstCount+=h}}else if(c.nodeType!=3&&typeof(c.tagName)!='undefined'&&c.tagName.toUpperCase()!='INPUT'&&c.tagName.toUpperCase()!='TEXTAREA'&&c.tagName.toUpperCase()!='IFRAME'){if(c.hasChildNodes){var t;for(t=0;t<c.childNodes.length;t++){if(d.foundNode)break;itdHLHighlightTextNode(a,b,c.childNodes[t],d)}}}}